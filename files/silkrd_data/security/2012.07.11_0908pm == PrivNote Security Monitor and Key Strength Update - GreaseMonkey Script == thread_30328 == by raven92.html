<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="robots" content="noindex" />
		<link rel="canonical" href="http://dkn255hz262ypmii.onion/index.php?topic=30328.0" />
		<title>Print Page - PrivNote Security Monitor &amp; Key Strength Update - GreaseMonkey Script</title>
		<style type="text/css">
			body, a
			{
				color: #000;
				background: #fff;
			}
			body, td, .normaltext
			{
				font-family: Verdana, arial, helvetica, serif;
				font-size: small;
			}
			h1#title
			{
				font-size: large;
				font-weight: bold;
			}
			h2#linktree
			{
				margin: 1em 0 2.5em 0;
				font-size: small;
				font-weight: bold;
			}
			dl#posts
			{
				width: 90%;
				margin: 0;
				padding: 0;
				list-style: none;
			}
			dt.postheader
			{
				border: solid #000;
				border-width: 1px 0;
				padding: 4px 0;
			}
			dd.postbody
			{
				margin: 1em 0 2em 2em;
			}
			table
			{
				empty-cells: show;
			}
			blockquote, code
			{
				border: 1px solid #000;
				margin: 3px;
				padding: 1px;
				display: block;
			}
			code
			{
				font: x-small monospace;
			}
			blockquote
			{
				font-size: x-small;
			}
			.smalltext, .quoteheader, .codeheader
			{
				font-size: x-small;
			}
			.largetext
			{
				font-size: large;
			}
			.centertext
			{
				text-align: center;
			}
			hr
			{
				height: 1px;
				border: 0;
				color: black;
				background-color: black;
			}
		</style>
	</head>
	<body>
		<h1 id="title">Silk Road forums</h1>
		<h2 id="linktree">Discussion => Security => Topic started by: raven92 on July 11, 2012, 09:08 pm</h2>
		<dl id="posts">
			<dt class="postheader">
				Title: <strong>PrivNote Security Monitor &amp; Key Strength Update - GreaseMonkey Script</strong><br />
				Post by: <strong>raven92</strong> on <strong>July 11, 2012, 09:08 pm</strong>
			</dt>
			<dd class="postbody">
				This is NOT an endorsement to use PrivNote, I recommend using GPG over using PrivNote. This script is a bandaid on semi-weak security, but if your not going to use GPG and insist on PrivNote, this is a must.<br /><br />Join Pine At The PGP Club -&gt; <br />http://dkn255hz262ypmii.onion/index.php?topic=30938<br /><br />If Your Stupid Ass Insists On PrivNote -&gt;<br /><br />With this script PrivNote&#039;s key generation is patched to acceptable security (Without the script PrivNote keys are weak, and breakable by remote parties).<br /><br />This update also calcualtes SHA-1 hash&#039;s for the script and HTML, if the Hash is ok the text will read &quot;Write your note below (Hash OK, Key Enhanced)&quot;, otherwise it will be &quot;WARNING!! PRIVNOTE HAS BEEN MODIFIED!!&quot; and you will receive message box letting you know hash details.<br /><br />The script will not auto-update for security reasons, the SHA-1 hash is below, and i&#039;d recommend waiting until another member verifies the work before using if you aren&#039;t comfortable with JScript yourself.<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">// ==UserScript==<br />// @id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PrivNote Randomizer Fix And Monitor<br />// @name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PrivNote Randomizer Fix And Monitor<br />// @version&nbsp; &nbsp; &nbsp; &nbsp; 1.0<br />// @namespace&nbsp; &nbsp; &nbsp; PrivNoteFix<br />// @author&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />// @description&nbsp; &nbsp; <br />// @include&nbsp; &nbsp; &nbsp; &nbsp; https://privnote.com/*<br />// @run-at&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document-end<br />// ==/UserScript==<br /><br />/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&nbsp; */<br />/*&nbsp; SHA-1 implementation in JavaScript<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; &nbsp; */<br />/*&nbsp; &nbsp;- see http://csrc.nist.gov/groups/ST/toolkit/secure_hashing.html&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/<br />/*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;http://csrc.nist.gov/groups/ST/toolkit/examples.html&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/<br />/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&nbsp; */<br /><br />var Sha1 = {};&nbsp; // Sha1 namespace<br /><br />/**<br />&nbsp;* Generates SHA-1 hash of string<br />&nbsp;*<br />&nbsp;* @param {String} msg&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String to be hashed<br />&nbsp;* @param {Boolean} [utf8encode=true] Encode msg as UTF-8 before generating hash<br />&nbsp;* @returns {String}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Hash of msg as hex character string<br />&nbsp;*/<br />Sha1.hash = function(msg, utf8encode) {<br />&nbsp; utf8encode =&nbsp; (typeof utf8encode == &#039;undefined&#039;) ? false : utf8encode;<br />&nbsp; <br />&nbsp; // convert string to UTF-8, as SHA only deals with byte-streams<br />&nbsp; if (utf8encode) msg = Utf8.encode(msg);<br />&nbsp; <br />&nbsp; // constants [§4.2.1]<br />&nbsp; var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];<br />&nbsp; <br />&nbsp; // PREPROCESSING <br />&nbsp; <br />&nbsp; msg += String.fromCharCode(0x80);&nbsp; // add trailing &#039;1&#039; bit (+ 0&#039;s padding) to string [§5.1.1]<br />&nbsp; <br />&nbsp; // convert string msg into 512-bit/16-integer blocks arrays of ints [§5.2.1]<br />&nbsp; var l = msg.length/4 + 2;&nbsp; // length (in 32-bit integers) of msg + ‘1’ + appended length<br />&nbsp; var N = Math.ceil(l/16);&nbsp; &nbsp;// number of 16-integer-blocks required to hold &#039;l&#039; ints<br />&nbsp; var M = new Array(N);<br />&nbsp; <br />&nbsp; for (var i=0; i&lt;N; i++) {<br />&nbsp; &nbsp; M[i] = new Array(16);<br />&nbsp; &nbsp; for (var j=0; j&lt;16; j++) {&nbsp; // encode 4 chars per integer, big-endian encoding<br />&nbsp; &nbsp; &nbsp; M[i][j] = (msg.charCodeAt(i*64+j*4)&lt;&lt;24) | (msg.charCodeAt(i*64+j*4+1)&lt;&lt;16) | <br />&nbsp; &nbsp; &nbsp; &nbsp; (msg.charCodeAt(i*64+j*4+2)&lt;&lt;8) | (msg.charCodeAt(i*64+j*4+3));<br />&nbsp; &nbsp; } // note running off the end of msg is ok &#039;cos bitwise ops on NaN return 0<br />&nbsp; }<br />&nbsp; // add length (in bits) into final pair of 32-bit integers (big-endian) [§5.1.1]<br />&nbsp; // note: most significant word would be (len-1)*8 &gt;&gt;&gt; 32, but since JS converts<br />&nbsp; // bitwise-op args to 32 bits, we need to simulate this by arithmetic operators<br />&nbsp; M[N-1][14] = ((msg.length-1)*8) / Math.pow(2, 32); M[N-1][14] = Math.floor(M[N-1][14])<br />&nbsp; M[N-1][15] = ((msg.length-1)*8) &amp; 0xffffffff;<br />&nbsp; <br />&nbsp; // set initial hash value [§5.3.1]<br />&nbsp; var H0 = 0x67452301;<br />&nbsp; var H1 = 0xefcdab89;<br />&nbsp; var H2 = 0x98badcfe;<br />&nbsp; var H3 = 0x10325476;<br />&nbsp; var H4 = 0xc3d2e1f0;<br />&nbsp; <br />&nbsp; // HASH COMPUTATION [§6.1.2]<br />&nbsp; <br />&nbsp; var W = new Array(80); var a, b, c, d, e;<br />&nbsp; for (var i=0; i&lt;N; i++) {<br />&nbsp; <br />&nbsp; &nbsp; // 1 - prepare message schedule &#039;W&#039;<br />&nbsp; &nbsp; for (var t=0;&nbsp; t&lt;16; t++) W[t] = M[i][t];<br />&nbsp; &nbsp; for (var t=16; t&lt;80; t++) W[t] = Sha1.ROTL(W[t-3] ^ W[t-8] ^ W[t-14] ^ W[t-16], 1);<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; // 2 - initialise five working variables a, b, c, d, e with previous hash value<br />&nbsp; &nbsp; a = H0; b = H1; c = H2; d = H3; e = H4;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; // 3 - main loop<br />&nbsp; &nbsp; for (var t=0; t&lt;80; t++) {<br />&nbsp; &nbsp; &nbsp; var s = Math.floor(t/20); // seq for blocks of &#039;f&#039; functions and &#039;K&#039; constants<br />&nbsp; &nbsp; &nbsp; var T = (Sha1.ROTL(a,5) + Sha1.f(s,b,c,d) + e + K[s] + W[t]) &amp; 0xffffffff;<br />&nbsp; &nbsp; &nbsp; e = d; d = c;<br />&nbsp; &nbsp; &nbsp; c = Sha1.ROTL(b, 30);<br />&nbsp; &nbsp; &nbsp; b = a; a = T;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; // 4 - compute the new intermediate hash value<br />&nbsp; &nbsp; H0 = (H0+a) &amp; 0xffffffff;&nbsp; H1 = (H1+b) &amp; 0xffffffff;&nbsp; &nbsp; &nbsp;H2 = (H2+c) &amp; 0xffffffff;&nbsp; H3 = (H3+d) &amp; 0xffffffff;&nbsp; &nbsp; &nbsp;H4 = (H4+e) &amp; 0xffffffff;<br />&nbsp; }<br /><br />&nbsp; return Sha1.toHexStr(H0) + Sha1.toHexStr(H1) + <br />&nbsp; &nbsp; Sha1.toHexStr(H2) + Sha1.toHexStr(H3) + Sha1.toHexStr(H4);<br />}<br /><br />//<br />// function &#039;f&#039; [§4.1.1]<br />//<br />Sha1.f = function(s, x, y, z)&nbsp; {<br />&nbsp; switch (s) {<br />&nbsp; case 0: return (x &amp; y) ^ (~x &amp; z);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Ch()<br />&nbsp; case 1: return x ^ y ^ z;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Parity()<br />&nbsp; case 2: return (x &amp; y) ^ (x &amp; z) ^ (y &amp; z);&nbsp; // Maj()<br />&nbsp; case 3: return x ^ y ^ z;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Parity()<br />&nbsp; }<br />}<br /><br />//<br />// rotate left (circular left shift) value x by n positions [§3.2.5]<br />//<br />Sha1.ROTL = function(x, n) {<br />&nbsp; return (x&lt;&lt;n) | (x&gt;&gt;&gt;(32-n));<br />}<br /><br />//<br />// hexadecimal representation of a number <br />//&nbsp; &nbsp;(note toString(16) is implementation-dependant, and&nbsp; <br />//&nbsp; &nbsp;in IE returns signed numbers when used on full words)<br />//<br />Sha1.toHexStr = function(n) {<br />&nbsp; var s=&quot;&quot;, v;<br />&nbsp; for (var i=7; i&gt;=0; i--) { v = (n&gt;&gt;&gt;(i*4)) &amp; 0xf; s += v.toString(16); }<br />&nbsp; return s;<br />}<br /><br />unsafeWindow.Sha1 = Sha1;<br />/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&nbsp; */<br /><br />unsafeWindow.random_seeder = 2345234561236161;<br />unsafeWindow.random_str = &quot;abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ!@$%^*&quot;;<br /><br /><br />lineDenote = &#039;\n&#039;;<br />unsafeWindow.pendingDocs = 0;<br />unsafeWindow.totalDocs = 0;<br />unsafeWindow.docSrc = {};<br />unsafeWindow.currentHash = &#039;&#039;;<br /><br />// check if we are creating or reading notes, reading notes the body hash changes to much, but isn&#039;t really needed, all script blocks are checked<br />unsafeWindow.calculateHash = function() {<br /><span style="white-space: pre;">	</span>if(document.location.pathname.indexOf(&quot;/n/destroyed&quot;) == 0) {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.expectedHash = &#039;script: https://ssl.google-analytics.com/ga.js\ninline-script: 3176eb62ad483e51089bb86fd0cc6817c2ca2ebd\ninline-script: 44b9385a410bc720f5329fd9dc78beabed4e8e2d\nhttps://privnote.com/static-1741/js/pack.js:d591f2018edab5d1cce50940f9cdce1940cff4a1&#039;;<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>else if(document.location.pathname.indexOf(&quot;/n/&quot;) == 0) {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>console.log(&#039;waiting...&#039;);<br /><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>setTimeout(unsafeWindow.calculateHash , 50); <br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>return;<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>else {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.currentHash&nbsp; = unsafeWindow.currentHash+&#039;bodyHash: &#039; +Sha1.hash(document.body.innerHTML)+lineDenote;<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.expectedHash = &#039;bodyHash: d409b5a7d516739786321dabf744d1ec9ed4d03f\nscript: https://ssl.google-analytics.com/ga.js\ninline-script: 3176eb62ad483e51089bb86fd0cc6817c2ca2ebd\ninline-script: 44b9385a410bc720f5329fd9dc78beabed4e8e2d\ninline-script: fe78ec3083f8c4584f6c504a3ad781f3aa63f354\nhttps://privnote.com/static-1741/js/pack.js:d591f2018edab5d1cce50940f9cdce1940cff4a1&#039;;<br /><span style="white-space: pre;">	</span>}<br /><br /><span style="white-space: pre;">	</span>console.log(&#039;Calculating...&#039;);<br /><br /><span style="white-space: pre;">	</span>for(i in document.scripts) {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>var s = document.scripts[i];<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>if(s.src == &#039;&#039;) {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.currentHash = unsafeWindow.currentHash+&#039;inline-script: &#039;+Sha1.hash(s.innerHTML)+lineDenote;<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>else {<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>// ignore google analytic code, assuming URL doesnt change<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>if(s.src == &#039;https://ssl.google-analytics.com/ga.js&#039;)&nbsp; {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.currentHash = unsafeWindow.currentHash+&#039;script: &#039;+s.src+lineDenote;<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>else {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.pendingDocs = unsafeWindow.pendingDocs+1;<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>// grab the script resource to hash validate it<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>GM_xmlhttpRequest({ method: &#039;GET&#039;,<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>url: s.src, <br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>onload: function(r) { <br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.docSrc[s.src] = r.responseText;<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.pendingDocs = unsafeWindow.pendingDocs-1;<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; });<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span>unsafeWindow.validateInterval = setInterval(unsafeWindow.validateHash, 5);<br />}<br /><br />unsafeWindow.validateHash = function()<br />{<br /><span style="white-space: pre;">	</span>if(unsafeWindow.pendingDocs &gt; 0) return;<br /><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span>// stop the check timer<br /><span style="white-space: pre;">	</span>clearInterval(unsafeWindow.validateInterval);<br /><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span>// add up all the script resource hashes<br /><span style="white-space: pre;">	</span>for(i in unsafeWindow.docSrc) {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>unsafeWindow.currentHash = unsafeWindow.currentHash+i+&#039;:&#039;+Sha1.hash(unsafeWindow.docSrc[i]);<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span>// if matches<br /><span style="white-space: pre;">	</span>if(unsafeWindow.currentHash != unsafeWindow.expectedHash) <br /><span style="white-space: pre;">	</span>{<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>var curHashFormat = unsafeWindow.currentHash.replace(new RegExp(&quot;\n&quot;, &quot;g&quot;), &quot;\\n&quot;);<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>alert(document.URL+&quot;\nPrivnote Not Validated, Hash has been modified, they may have added a back door!&quot;+<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &quot;\n\nExpected\n----------------------\n&quot;+unsafeWindow.expectedHash+<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &quot;\n\nNew Hash Values\n---------------------------\n&quot; +unsafeWindow.currentHash+<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &quot;\n\nHash String\n---------------------------\n&quot; +curHashFormat);<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>document.getElementById(&quot;noteformw&quot;).children[0].innerHTML = &quot;&lt;span style=&#039;color:red&#039;&gt;WARNING!! PRIVNOTE HAS BEEN MODIFIED!!&lt;/span&gt;&quot;;<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>else<br /><span style="white-space: pre;">	</span>{<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>document.getElementById(&quot;noteformw&quot;).children[0].innerHTML = &quot;Write your note below (Hash OK, Key Enhanced)&quot;;<span style="white-space: pre;">	</span><br /><span style="white-space: pre;">	</span>}<span style="white-space: pre;">	</span><br />}<br /><br />unsafeWindow.calculateHash ();<br /><br />function setCharAt(str,index,chr) {<br />&nbsp; &nbsp; if(index &gt; str.length-1) return str;<br />&nbsp; &nbsp; return str.substr(0,index) + chr + str.substr(index+1);<br />}<br /><br />// <br />// Enhance the random string based on the mouse movement so key can not be guessed by time of generation due to firefox having bad Math.random implementations<br />unsafeWindow.onmousemove = function(e) {<br />&nbsp; &nbsp; var B&nbsp; = unsafeWindow.random_str;<br />&nbsp; &nbsp; var p1 = Math.abs(Math.floor(Math.random() * B.length));<br />&nbsp; &nbsp; var p2 = Math.abs(Math.floor(Math.random() * B.length));<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; unsafeWindow.random_str = setCharAt(unsafeWindow.random_str, p1, B.charAt(p2));<br />&nbsp; &nbsp; unsafeWindow.random_str = setCharAt(unsafeWindow.random_str, p2, B.charAt(p1));<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; unsafeWindow.random_seeder = unsafeWindow.random_seeder + ((Math.random()*99999999) * e.clientX + e.clientY);<br />}<br /><br />unsafeWindow.random_string = function(C) {<br />&nbsp; &nbsp; if (C === null) <br />&nbsp; &nbsp; &nbsp; &nbsp; C = 16&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; var B = unsafeWindow.random_str;<br />&nbsp; &nbsp; var D = &quot;&quot;;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; //alert(unsafeWindow.random_seeder);<br /><br />&nbsp; &nbsp; for (var A = 0; A &lt; C; A++) {<br />&nbsp; &nbsp; &nbsp; &nbsp; pos = Math.floor( (unsafeWindow.random_seeder * (Math.random() * B.length)) % B.length );<br />&nbsp; &nbsp; &nbsp; &nbsp; D += B.charAt(pos)<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; return D<br />}<br /></code><br />GPG SHA-1 SUM: 949c1495979872330e75c14eff9f07a510cf68e9<br /><br /><br /><br />Old Details<br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">That being said I am a big believer in the truth being spread instead of half-assed uneducated guesses and rumors. As well I realize people are insanely lazy and have a chance of maybe using a GreaseMonkey script but no chance of using GPG and i&#039;d rather people be slightly more secure than not.<br /><br />After KMFKwerm&#039;s post regarding PrivNote security, I started being curious just how secure PrivNote is, and found the key generation to be weak, but seemed to verify that your actual decrypted text nor key was ever sent to PrivNote.<br /><br />Being bored in the last few days, I successfully was able to guess the random number within enough precision to bruteforce the key within 2 hours. In short, I could decrypt the text of one note stored on PrivNote&#039;s servers without the key given 2 hours and some extra information that would be relatively hard to obtain<br /><br />I&#039;ve created a small GreaseMonkey script that will make the key generation stronger and harder to be guessed. This still does not fix the fact that if anyone has the ClientURL+EncryptedText or ClientURL+MITM they could decrypt the text.<br /><br />***NOTE***<br />The key is limited to 16 only because the response jscript on PrivNote&#039;s side expects location.hash to be 16, while this is a clientside check, im not sure how from GreaseMonkey to intercept and allow keys &gt; 16, but you can verify that PrivNote still doesnt actually care.<br /><br />When you use a key &gt; 16, and attempt to decrypt privnote will end you up at /error, simply change the url to /n/destroyed/#hash after the error page comes (privnote obviously stores your internal hash in your sessionID, which is not insecure) and it will still decrypt even with 256 byte passwords<br /></code><br />Information On How PrivNote works from reverse engineering:<br />http://dkn255hz262ypmii.onion/index.php?topic=24799.msg323573#msg323573
			</dd>
			<dt class="postheader">
				Title: <strong>Re: PrivNote Key Flaw - Update &amp; GreaseMonkey Script</strong><br />
				Post by: <strong>vlad1m1r</strong> on <strong>July 11, 2012, 09:33 pm</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=30328.msg338769#msg338769">Quote from: raven92 on July 11, 2012, 09:08 pm</a></div></div><blockquote class="bbc_standard_quote">First off this is NOT an endorsement to use PrivNote, I recommend using GPG over using PrivNote. <br /><br />That being said I am a big believer in the truth being spread instead of half-assed uneducated guesses and rumors. As well I realize people are insanely lazy and have a chance of maybe using a GreaseMonkey script but no chance of using GPG and i&#039;d rather people be slightly more secure than not.<br /><br />After KMFKwerm&#039;s post regarding PrivNote security, I started being curious just how secure PrivNote is, and found the key generation to be weak, but seemed to verify that your actual decrypted text nor key was ever sent to PrivNote.<br /><br />Being bored in the last few days, I successfully was able to guess the random number within enough precision to bruteforce the key within 2 hours. In short, I could decrypt the text of one note stored on PrivNote&#039;s servers without the key given 2 hours and some extra information that would be relatively hard to obtain<br /><br />I&#039;ve created a shitty GreaseMonkey script that will slightly enhance the security of PrivNote by making the key slightly stronger, this could be dramatically improved, but I did not have the time to complete it (if someone wants to go for it, I recommend using keystroke / mouse movement to fuck with the seed)<br /><br />It&#039;s imperative to help increase the key strength that you use your own random_seed number, and never tell anyone what you used, i&#039;ve thrown a random seed in.<br /><br />***NOTE***<br />The key is limited to 16 only because the response jscript on PrivNote&#039;s side expects location.hash to be 16, while this is a clientside check, im not sure how from GreaseMonkey to intercept and allow keys &gt; 16, but you can verify that PrivNote still doesnt actually care.<br /><br />When you use a key &gt; 16, and attempt to decrypt privnote will end you up at /error, simply change the url to /n/destroyed/#hash after the error page comes (privnote obviously stores your internal hash in your sessionID, which is not insecure) and it will still decrypt even with 256 byte passwords<br /><br /><br /><br /><br />// ==UserScript==<br />// @id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;a<br />// @name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PrivNote Random<br />// @version&nbsp; &nbsp; &nbsp; &nbsp; 1.0<br />// @namespace&nbsp; &nbsp; &nbsp; <br />// @author&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />// @description&nbsp; &nbsp; <br />// @include&nbsp; &nbsp; &nbsp; &nbsp; https://privnote.com/*<br />// @run-at&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document-end<br />// ==/UserScript==<br /><br />unsafeWindow.random_seeder = 93248532485239;<br />unsafeWindow.random_string = function(C) {<br />&nbsp; &nbsp; if (C === null) {<br />&nbsp; &nbsp; &nbsp; &nbsp; C = 16<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; var B = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@$%^*&quot;;<br />&nbsp; &nbsp; var D = &quot;&quot;;<br />&nbsp; &nbsp; <br /><br />&nbsp; &nbsp; for (var A = 0; A &lt; C; A++) {<br />&nbsp; &nbsp; &nbsp; &nbsp; pos = Math.floor( (unsafeWindow.random_seeder * (Math.random() * B.length)) % B.length );<br />&nbsp; &nbsp; &nbsp; &nbsp; D += B.charAt(pos)<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; return D<br />}<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />And from me, many thanks Raven.<br /><br />V.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: PrivNote Key Flaw - GreaseMonkey Script *UPDATE*</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>July 12, 2012, 07:42 am</strong>
			</dt>
			<dd class="postbody">
				The decrypted message must be available to privnote, there is no such thing as entirely server side encryption that is secure from the server providing it. If I understand privnote correctly, the key to decrypt is in the URL. So they generate the key for you. That means they have access to the plaintext. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: PrivNote Key Flaw - GreaseMonkey Script *UPDATE*</strong><br />
				Post by: <strong>raven92</strong> on <strong>July 12, 2012, 07:52 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=30328.msg339959#msg339959">Quote from: kmfkewm on July 12, 2012, 07:42 am</a></div></div><blockquote class="bbc_standard_quote">The decrypted message must be available to privnote, there is no such thing as entirely server side encryption that is secure from the server providing it. If I understand privnote correctly, the key to decrypt is in the URL. So they generate the key for you. That means they have access to the plaintext.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />You&#039;re absolutely correct that there is no such thing as server side encryption that is secure from the server seeing it. But that&#039;s not how privnote works.<br /><br />The encryption/decryption is 100% client side, not server side. The server hashes the Encrypted text to obtain a hashid. The URL used to retrieve is /n/&lt;hashid&gt;/#key, the appending of #key is done entirely client-side, the key is never transmitted to the server, just the encrypted text. When you retrieve it, you send them only the HashID, they send the encrypted text back, and javascript locally decrypts the text and injects it into the HTML page. I explain this in more detail in the other thread you started.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: PrivNote Key Flaw - GreaseMonkey Script *UPDATE*</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>July 12, 2012, 08:29 am</strong>
			</dt>
			<dd class="postbody">
				Ah wasn&#039;t aware that they were doing it in such a way , that does make it much safer than I thought it was although nothing stops them from changing the javascript. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: PrivNote Security Monitor &amp; Key Strength Update - GreaseMonkey Script</strong><br />
				Post by: <strong>raven92</strong> on <strong>September 08, 2012, 05:06 am</strong>
			</dt>
			<dd class="postbody">
				See the first post, I updated it with all the details.<br /><br />I added important monitoring features to this script based on requests from pine to monitor PrivNote.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: PrivNote Security Monitor &amp; Key Strength Update - GreaseMonkey Script</strong><br />
				Post by: <strong>pine</strong> on <strong>September 09, 2012, 11:55 pm</strong>
			</dt>
			<dd class="postbody">
				Thanks Raven! :)
			</dd>
		</dl>
		<div id="footer" class="smalltext">
			
			<span class="smalltext" style="display: inline; visibility: visible; font-family: Verdana, Arial, sans-serif;"><a href="http://dkn255hz262ypmii.onion/index.php?action=credits" title="Simple Machines Forum" target="_blank" class="new_win">SMF 2.0.5</a> |
 <a href="http://www.simplemachines.org/about/smf/license.php" title="License" target="_blank" class="new_win">SMF &copy; 2013</a>, <a href="http://www.simplemachines.org" title="Simple Machines" target="_blank" class="new_win">Simple Machines</a>
			</span>
		</div>
	</body>
</html>