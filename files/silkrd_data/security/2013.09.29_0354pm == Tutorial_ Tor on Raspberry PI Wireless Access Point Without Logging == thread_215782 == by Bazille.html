<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="robots" content="noindex" />
		<link rel="canonical" href="http://dkn255hz262ypmii.onion/index.php?topic=215782.0" />
		<title>Print Page - Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</title>
		<style type="text/css">
			body, a
			{
				color: #000;
				background: #fff;
			}
			body, td, .normaltext
			{
				font-family: Verdana, arial, helvetica, serif;
				font-size: small;
			}
			h1#title
			{
				font-size: large;
				font-weight: bold;
			}
			h2#linktree
			{
				margin: 1em 0 2.5em 0;
				font-size: small;
				font-weight: bold;
			}
			dl#posts
			{
				width: 90%;
				margin: 0;
				padding: 0;
				list-style: none;
			}
			dt.postheader
			{
				border: solid #000;
				border-width: 1px 0;
				padding: 4px 0;
			}
			dd.postbody
			{
				margin: 1em 0 2em 2em;
			}
			table
			{
				empty-cells: show;
			}
			blockquote, code
			{
				border: 1px solid #000;
				margin: 3px;
				padding: 1px;
				display: block;
			}
			code
			{
				font: x-small monospace;
			}
			blockquote
			{
				font-size: x-small;
			}
			.smalltext, .quoteheader, .codeheader
			{
				font-size: x-small;
			}
			.largetext
			{
				font-size: large;
			}
			.centertext
			{
				text-align: center;
			}
			hr
			{
				height: 1px;
				border: 0;
				color: black;
				background-color: black;
			}
		</style>
	</head>
	<body>
		<h1 id="title">Silk Road forums</h1>
		<h2 id="linktree">Discussion => Security => Topic started by: Bazille on September 29, 2013, 03:54 pm</h2>
		<dl id="posts">
			<dt class="postheader">
				Title: <strong>Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:54 pm</strong>
			</dt>
			<dd class="postbody">
				This step-by-step tutorial explains how to install Raspbian with Tor on a Raspberry PI remotely (without connecting a keyboard/monitor to the Raspberry PI).<br />It is based on the Onion PI tutorial from Adafruit but has many changes and additions. Every step needed to make it work is mentioned in the tutorial.<br /><br />The system functions as a wireless access point which physically isolates the wireless computers from the rest of the network.<br />This means that the computers connecting to it through wifi can only connect to the internet through Tor.<br />The wireless computers will not be able to connect to other computers in the local network.<br /><br />You can also use it as a Tor proxy through the local network provided by your router, but the computer will not be physically isolated from the rest of the local network/internet in that case.<br /><br />It is assumed that you have a router which is connected to the internet and automatically assigns an IP address to the Raspberry PI when you connect it with a cable.<br />With a few modifications it should be possible to connect a 3G modem or another wireless card to connect to mobile internet, but that is not covered by this tutorial.<br /><br />The system is not a transparent proxy which tunnels all connections from the wireless computers through Tor. That could potentially provide an attacker with too much information. <br />Instead it only forwards connections which specifically use the Tor/Privoxy proxies running on the Raspberry PI.<br /><br />If you are Edward Snowden, then you should take extra care about the computers you connect to the wireless access point. That is not covered by this tutorial.<br />Generally the laptop should have been bought anonymously with cash and never have been connected to the internet through your local network.<br /><br />The setup should look like this:<br /><br />Clean laptop -&gt; Raspberry PI wifi adapter -&gt; Tor/Privoxy running on Raspberry PI -&gt; Raspberry PI ethernet cable -&gt; router -&gt; internet<br /><br /><br />Features:<br /><br />* Uses latest development version of Tor<br />* Privoxy HTTP proxy which can only connect to the Tor socks proxy<br />* Iptables firewall which restricts input from all network interfaces and impedes SSH brute forcing<br />* Logging is diverted to a ram disk - after powering off the Raspberry PI it will not be visible how often computers connected to the Raspberry PI or which MAC address they used<br />* Swap is disabled to prevent swapping memory to the SD card<br />* Fetches time using tlsdate (secure parasitic rdate replacement coded by one of the Tor developers)<br /><br />Skill needed:<br />Using the command line a lot. No graphical interface will be used during the installation. You don&#039;t really need to understand what you are doing however, as long as you exactly follow the instructions.<br /><br />Requirements: <br /><br />* Raspberry PI Model B preferably with case<br />* Micro-USB charger/power supply<br />* Wifi dongle - this tutorial is specifically made with the Edimax EW-7811Un wifi adapter in mind, Onion PI wifi adapters will work too<br />* SD card reader<br />* 4GB SD card, preferably with 20-30mb/s reading speed<br />* Router with RJ-45 network cable port and connection to the internet<br />* Computer with wireless or cable connection to the router<br />* Network cable (RJ-45)<br /><br />Instead of purchasing all parts seperately you could buy an Onion PI bundle from Adafruit:<br /><br />Onion PI with mini wifi dongle<br />https://www.adafruit.com/products/1410<br /><br />Onion PI with wifi antenna dongle<br />https://www.adafruit.com/products/1406<br /><br /><br />DISCLAIMER: This tutorial is work in progres. Do not rely on it for strong security. If you aren&#039;t Edward Snowden it may be secure enough however. While it doesn&#039;t prevent traffic correlation this system provides more security than the Onion PI tutorial. <br /><br />Date: 29.09.2013
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:54 pm</strong>
			</dt>
			<dd class="postbody">
				1. Download files<br /><br />Download the latest version of win32diskimager:<br />http://sourceforge.net/projects/win32diskimager/files/latest/download<br /><br />If you don&#039;t use Windows you need to Google how to write the .img file to the SD card.<br /><br />Download the latest version of Raspbian:<br />http://downloads.raspberrypi.org/raspbian_latest<br />or<br />http://downloads.raspberrypi.org/raspbian_latest.torrent<br /><br />If you&#039;re using Windows download Putty (SSH client):<br />http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe<br /><br /><br />2. Writing Raspbian OS to SD card<br /><br />Unzip the Win32 Disk Imager and Raspbian ZIP files.<br /><br />Start Win32 Disk Imager, select the Raspbian IMG file and select the proper device (SD card).<br />Click Write to write the image to the SD card.<br /><br />When writing is finished put the SD card into the Raspberry PI.<br />Use the ethernet cable to connect the Raspberry PI to your router.<br />Do not connect the wifi dongle yet.<br />Power on the Raspberry PI by connecting it to the USB power supply and wait 30 seconds.<br /><br />3. Find out the IP address of the Raspberry PI<br /><br />Now you have to find out the IP address which was assigned to the Raspberry PI by your router.<br />You can probably do this by using the web interface of your router, or you can guess it by looking at the LAN IP address of your desktop computer.<br /><br />Press Windows key + R and enter &quot;cmd.exe&quot;.<br />At the DOS prompt enter &quot;ipconfig&quot;.<br /><br />You should see a line like this, which shows the IP address of your computer in the local network.<br />IPv4 Address 192.168.0.101<br /><br />Now you can send a ping request to random IP addresses in your local network and see if any of them sends an answer. You may have to allow it in your firewall or turn the firewall off.<br />If you don&#039;t have any other devices connected to your router, then the Raspberry IP address may be &lt;desktop IP address + 1&gt;, e.g. 192.168.0.102.<br /><br />Enter &quot;ping 192.168.0.102&quot; and wait a few seconds.<br />If you get a &quot;Reply from 192.168.0.102&quot; response, then that is the IP address of your Raspberry PI.<br /><br />If there is no reply, press CTRL-c and enter &quot;ping 192.168.0.103&quot;. Keep incrementing the last number until you get a ping reply.<br /><br />If that fails, then you can also use other tools to detect the IP addresses of devices connected to your router, e.g. Fing:<br />http://www.overlooksoft.com/download<br />If this doesn&#039;t help then Google is your friend. Search for &quot;how do i find out the ip address raspberry pi remotely&quot; or ask in the forum.<br /><br />When you found out the IP address write it down so you don&#039;t forget it later. <br /><br /><br />3. Connect with SSH<br /><br />To setup the Raspberry PI without keyboard and monitor it is necessary to use SSH.<br /><br />If you&#039;re using Windows, start Putty.exe, enter the IP address you wrote down as host name and click Open.<br /><br />If you&#039;re using Linux, open a terminal and enter &quot;ssh pi@192.168.0.101&quot;, replace the IP address with the correct address.<br /><br />If you got the right IP address then you should see a login prompt (&quot;login as:&quot;).<br />Enter &quot;pi&quot; and use &quot;raspberry&quot; as password.<br /><br />You should see command prompt<br />pi@raspberrypi ~ $<br /><br />Enter this command to start the Raspbian configuration tool:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo raspi-config<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press enter to Expand Filesystem, so the SD card partition will be enlarged.<br />Use cursor keys to navigate the menu to Change User Password.<br />Press enter and enter your new password 2 times. The password should not be guessable and not in a dictionary. 8 characters or more is recommended.<br />Select &quot;Finish&quot; by using the cursor keys and press enter.<br />Press enter again to reboot now.<br /><br />Wait a minute, then start Putty.exe again with the same IP address as before. This time use your new password for logging in. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:55 pm</strong>
			</dt>
			<dd class="postbody">
				4. Installing and updating packages<br /><br />4.1. Changing/adding package sources<br /><br />When you&#039;re at the command prompt again enter<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/apt/sources.list<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><br />Look at the line<br />deb http://mirrordirector.raspbian.org/raspbian/ wheezy main contrib non-free rpi<br /><br />&quot;wheezy&quot; is the current default repository of Raspbian, this may change in the future.<br />Change wheezy to jessie if it isn&#039;t set to jessie already. This is needed to install tlsdate later.<br /><br />Navigate to the end of the text file with the cursors keys.<br />Paste these 2 lines by copying them to your clipboard and pressing the right mouse button in the Putty window:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">deb-src http://deb.torproject.org/torproject.org jessie main<br />deb-src http://deb.torproject.org/torproject.org experimental-jessie main<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-x to save the changes, enter y and press enter to confirm the filename<br /><br /><br />4.2. Updating packages<br /><br />At the command prompt enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade -y</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />This can take a 20 inutes to complete. If you get a message about restarting services select Yes.<br />If you get an error about dependencies enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">apt-get -f install</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><br />4.3. Compiling and setting up Tor<br /><br />Because the torproject repository doesn&#039;t currently seem to provide correct packages for the Raspberry PI it is necessary to compile the latest version of Tor.<br />Don&#039;t worry, you don&#039;t need to understand anything about programming to do this. Simply follow the instructions.<br /><br />At the command prompt enter <br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get install build-essential fakeroot devscripts -y<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />This will take a few minutes to complete.<br />When the command prompt is visible again paste these lines<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">gpg --keyserver keys.gnupg.net --recv 886DDD89<br />gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add -<br /><br />sudo apt-get update<br />sudo apt-get install deb.torproject.org-keyring -y<br />sudo apt-get build-dep tor -y<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />When the command prompt is visible again enter<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">cd<br />mkdir debian-packages<br />cd debian-packages<br />apt-get source tor<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Wait until the download is finished then enter<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">cd tor-*<br />debuild -rfakeroot -uc -us<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />The latest development version of Tor will now get compiled. This will take about 45 minutes to complete.<br />When the command prompt is visible again enter the following lines to install Tor:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">cd ..<br />sudo dpkg -i tor_*.deb<br />sudo dpkg -i tor-geo*<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />To replace the Raspbian fake clock with tlsdate and install the relay monitor enter the next 2 lines. Tlsdate does pretty much the same as the fake clock, but it&#039;s more secure.<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get install tor-arm tlsdate -y<br />sudo apt-get remove fakehw-clock -y<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Tor-arm is the anonymous relay monitor command line tool which provides similar functionality as Vidalia.<br /><br />Next edit the Tor configuration file:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano /etc/tor/torrc</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Paste these lines into the editor:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">SocksPort 9050<br />SocksPort 0.0.0.0:9001<br />SocksPort 0.0.0.0:9002 IsolateDestAddr IsolateDestPort<br />StrictNodes 1<br />AvoidDiskWrites 1<br />DisableDebuggerAttachment 0<br />EntryNodes {us}<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />The SocksPort 0.0.0.0* lines will trigger warnings when starting Tor, but this is not a problem, as it will get restricted by iptables later.<br />Change the &quot;us&quot; in the Entrynodes {us} line to your country code, so Tor will only use entry guards in your country.<br />The country codes are not top level domains. Have a look at this is a list to find the country code you have to use: http://dev.maxmind.com/geoip/legacy/codes/iso3166/<br /><br /><br />You could also use bridges instead of the EntryNodes line.<br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br /><br />4.4. Privoxy<br /><br />Tor is not a HTTP proxy, so to connect to Tor with a browser we need to install a proxy which uses the Tor socks proxy.<br /><br />At the command prompt enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get install privoxy -y<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div> <br />&nbsp;<br />Find the lines which says &quot;listen-address&nbsp; localhost:8118&quot; and change it to &quot;listen-address :8118&quot;.<br /><br />Scroll down to the end of the text file and enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">forward-socks5 / 127.0.0.1:9050 .</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:55 pm</strong>
			</dt>
			<dd class="postbody">
				4.5. DHCP server and access point<br />&nbsp;<br />To automatically assign IP addresses to wireless computers connecting to the Raspberry PI access point it is necessary to install a DHCP server.<br /><br />At the command prompt enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get install hostapd isc-dhcp-server -y<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />4.5.1 DHCP server<br /><br />Edit the DHCP config file by entering<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/dhcp/dhcpd.conf <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Find the lines that say<br /><br />&nbsp; &nbsp; option domain-name &quot;example.org&quot;;<br />&nbsp; &nbsp; option domain-name-servers ns1.example.org, ns2.example.org;<br /><br />and change them to add a # in the beginning so they say<br /><br />&nbsp; &nbsp; #option domain-name &quot;example.org&quot;;<br />&nbsp; &nbsp; #option domain-name-servers ns1.example.org, ns2.example.org;<br /><br />Find the lines that say<br /><br />&nbsp; &nbsp; # If this DHCP server is the official DHCP server for the local<br />&nbsp; &nbsp; # network, the authoritative directive should be uncommented.<br />&nbsp; &nbsp; #authoritative;<br /><br />and remove the # so it says<br /><br />&nbsp; &nbsp; # If this DHCP server is the official DHCP server for the local<br />&nbsp; &nbsp; # network, the authoritative directive should be uncommented.<br />&nbsp; &nbsp; authoritative;<br />&nbsp;&nbsp;&nbsp;<br />Then scroll down to the bottom of the text file and paste the following lines<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">subnet 10.0.42.0 netmask 255.255.255.0 {<br />range 10.0.42.10 10.0.42.50;<br />option broadcast-address 10.0.42.255;<br />option routers 10.0.42.1;<br />default-lease-time 600;<br />max-lease-time 7200;<br />option domain-name &quot;local&quot;;<br />option domain-name-servers 10.0.42.1;<br />option ntp-servers 10.0.42.1;<br />}<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter the next line to edit the DHCP server parameters:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/default/isc-dhcp-server<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Scroll down to INTERFACES=&quot;&quot; and update it to say INTERFACES=&quot;wlan0&quot;. <br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br /><br />4.5.2. Wifi adapter configuration<br /><br />Enter the next line to edit the wifi adapter configuration:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/network/interfaces<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Find the line with &quot;iface wlan0&quot; and add a # in front of the line, and in front of every line afterwards. <br />&nbsp;<br />Then add the lines<br />&nbsp;<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">iface wlan0 inet static<br />address 10.0.42.1<br />netmask 255.255.255.0<br />up iptables-restore &lt; /etc/iptables.rules<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div>&nbsp; <br />&nbsp;<br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br />&nbsp;<br />&nbsp;<br />4.5.3. Access point <br />&nbsp; <br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano /etc/hostapd/hostapd.conf<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div> <br />Paste the following in, you can change the text after ssid= to another name, that will be the network broadcast name. The password can be changed with the text after wpa_passphrase=<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">interface=wlan0<br />driver=rtl871xdrv<br />ssid=NSA_GCHQ<br />hw_mode=g<br />channel=6<br />macaddr_acl=0<br />auth_algs=1<br />ignore_broadcast_ssid=0<br />wpa=2<br />wpa_passphrase=snowden23<br />wpa_key_mgmt=WPA-PSK<br />wpa_pairwise=CCMP<br />rsn_pairwise=CCMP<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Make sure each line has no extra spaces or tabs at the end or beginning - this file is pretty picky!<br />If you don&#039;t use the Edimax wifi dongle or the Onion PI then you may have to change the driver= line. This is not covered by this tutorial.<br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br />&nbsp;<br />Enter <br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano /etc/default/hostapd<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Find the line #DAEMON_CONF=&quot;&quot; and edit it so it says DAEMON_CONF=&quot;/etc/hostapd/hostapd.conf&quot;<br />Don&#039;t forget to remove the # in front to activate it!<br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br />&nbsp;<br />&nbsp;<br />4.5.4. Download access point software from Adafruit<br />&nbsp; <br />If you use the Edimax EW-7811Un wifi dongle or the Adafruit Onion PI then you&#039;ll have to use a special version of the access point software:<br /><br />Enter these lines:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">cd; mkdir downloads; cd downloads<br />wget http://www.adafruit.com/downloads/adafruit_hostapd.zip<br />unzip adafruit_hostapd.zip<br />sudo mv /usr/sbin/hostapd /usr/sbin/hostapd.ORIG<br />sudo mv hostapd /usr/sbin<br />sudo chmod 755 /usr/sbin/hostapd<br />sudo reboot<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Wait 30 seconds and connect to the PI again with Putty. You can connect the wifi dongle now or later.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:56 pm</strong>
			</dt>
			<dd class="postbody">
				5. Prevent logging to SD card<br /><br />To increase the lifetime of the SD card and to not disclose informations about which MAC addresses connected to the Raspberry PI logging has to be diverted to the ram disk.<br />After rebooting the Raspberry PI no informations of previous connections will be left. Simply turning off the Raspberry PI may reveal the data since last reboot in a cold boot attack however.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo su</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div>and enter your password.<br /><br />You are now logged in as root (admin).<br /><br />5.1. Stop and disable services<br /><br />Enter these lines to stop the services and disable them from starting too early at boot time:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">/etc/init.d/tor stop<br />/etc/init.d/privoxy stop<br />/etc/init.d/isc-dhcp-server stop<br /><br />update-rc.d tor disable<br />update-rc.d privoxy disable<br />update-rc.d isc-dhcp-server disable<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />5.2. Create ram disk<br /><br />Enter the next lines to erase the tor logfile and create a mount point for a ram disk.<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">rm -f /var/log/tor/log<br />mkdir /mnt/ramdisk<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Enter the next line to edit the fstab file which automatically mounts disks at boot time:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano /etc/fstab<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><br />Use the cursor keys to get to the bottom of the text file and paste these lines:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">none /tmp ramfs defaults 0 0<br />none /mnt/ramdisk ramfs defaults 0 0<br />none /var/log/tor ramfs defaults 0 0<br />none /var/log/privoxy ramfs defaults 0 0<br />none /var/log/apt ramfs defaults 0 0<br />none /var/lib/dhcp ramfs defaults 0 0<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter the next lines to mount the ram disks, move the current syslog to the ramdisk and uninstall the swap file package:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">mount -a<br />mv /var/log/syslog /mnt/ramdisk/syslog; ln -s /mnt/ramdisk/syslog /var/log/syslog<br />mv /var/log/messages /mnt/ramdisk/messages; ln -s /mnt/ramdisk/messages /var/log/messages<br /><br />apt-get remove dphys-swapfile -y<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><br />5.3. Startup script<br /><br />Edit the rc.local script which gets executed at boot time by entering<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano /etc/rc.local<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Before the last line (&quot;exit 0&quot;) enter the following lines, which will start Tor, DHCP and access point after changing some folder permissions:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">chmod 777 /var/log/tor &amp;&amp; /etc/init.d/tor restart<br />chmod 777 /var/log/privoxy &amp;&amp; /etc/init.d/privoxy restart<br />chmod 1777 /tmp<br /><br />touch /var/lib/dhcp/dhcpd.leases &amp;&amp; /etc/init.d/isc-dhcp-server restart<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:57 pm</strong>
			</dt>
			<dd class="postbody">
				6. Firewall<br /><br />The system should by quite secure, but it doesn&#039;t hurt to add some extra security with an iptables firewall.<br />It will prevent all unnecessary incoming connections from all network interfaces and makes sure it would take a very long time to successfully brute force the SSH server.<br /><br />If an unauthorized person gets your access point password they won&#039;t be able to do anything except connecting to Tor and trying to very slowly brute force the SSH server.<br /><br />You are probably still logged in as root, so enter &quot;exit&quot;.<br /><br />Enter the next 2 lines to change to the pi home directory and create a firewall script:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">cd<br />nano firewall<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Paste the following script into the editor:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">##################################<br />#<br /># CHANGE THE NEXT LINE BEFORE RUNNING THE FIREWALL SCRIPT<br /><br />LOCALNET=192.168.0.0<br /><br /># this should be the local network of your router<br />#<br />##################################<br /><br />iptables -F<br /><br />iptables -P INPUT DROP<br />iptables -P FORWARD DROP<br />iptables -P OUTPUT ACCEPT<br /><br />iptables -A INPUT -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT<br /><br /># allow loopback<br />iptables -A OUTPUT -o lo -j ACCEPT<br />iptables -A INPUT -i lo -j ACCEPT<br /><br />iptables -A INPUT -i eth0 -p udp --sport 53 -j ACCEPT # dns response from ethernet<br />iptables -A INPUT -i wlan0 -p udp --dport 67 -j ACCEPT # dhcp requests from wifi<br />iptables -A INPUT -i wlan0 -p udp --dport 123 -j ACCEPT # time requests from wifi&nbsp; <br /><br /># accept privoxy and ssh connections from wifi and local network<br />iptables -A INPUT -i wlan0 -p tcp --dport 22 -j ACCEPT<br />iptables -A INPUT -i wlan0 -p tcp --dport 8118 -j ACCEPT<br />iptables -A INPUT -i eth0 -p tcp -s $LOCALNET/24 --dport 22 -j ACCEPT<br />iptables -A INPUT -i eth0 -p tcp -s $LOCALNET/24 --dport 8118 -j ACCEPT<br /><br /># accept tor socks connections from wifi and local network<br />iptables -A INPUT -i wlan0 -p tcp --dport 9000:9020 -j ACCEPT<br />iptables -A INPUT -i eth0 -p tcp -s $LOCALNET/24 --dport 9000:9020 -j ACCEPT<br /><br /># allow only 2 connections to SSH per minute to make brute forcing useless<br />iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --set<br />iptables -I INPUT -p tcp --dport 22 -m state --state NEW -m recent --update --seconds 60 --hitcount 2 -j DROP<br /><br /># probably not necessary: drop privoxy connections through ethernet<br />iptables -A OUTPUT -o eth0 ! -d $LOCALNET/24 -j DROP -m owner --uid-owner privoxy<br /><br />iptables -L -v<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Note the line LOCALNET=. You have to change this to point at your local network IP range. <br />If the IP address of the Raspberry PI is 192.168.0.something then you can leave the line as it is.<br />If the IP address of the PI is 172.168.0.something then you have to change the line to LOCALNET=172.168.0.0.<br />Basically you simply replace the last number of the Raspberry PI IP address with a 0.<br /><br />If you don&#039;t get this right then you will lock yourself out of the Raspberry PI until the next reboot.<br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter the next 2 lines to make the firewall script executable and activate it:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">chmod +x firewall<br />sudo ./firewall<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />If you still have a connection to the Raspberry PI at this point, then everything went well and you have to edit the firewall script again.<br />If you get disconnected from the PI at this point then you have to restart it and make sure you enter the right IP range in the LOCALNET= line.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano firewall</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Scroll down to the end of the text file and enter in a new line:<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">iptables-save &gt; /etc/iptables.rules</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Again enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo ./firewall</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />This will save the firewall rules to a file in the /etc folder which will get applied automatically when the network interfaces start up.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:57 pm</strong>
			</dt>
			<dd class="postbody">
				7. Using the system<br /><br />The installation is now complete. Reboot the Raspberry PI by entering &quot;sudo reboot&quot; and boot your laptop.<br /><br />Connect the laptop to the right access point (&quot;NSA_GCHQ&quot; if you didn&#039;t change the name) and enter the access point password (&quot;snowden&quot; if you didn&#039;t change it).<br />Go to the network configuration in your web browser and enter 10.0.42.1 port 8118 as proxy server.<br />If you want to use it as a Tor proxy from within your local network (connected through the router) then you have to replace 10.0.42.1 with the Raspberry PI IP addresse, e.g. 192.168.0.101.<br />Connecting to it through the router does not provide physical isolation however.<br /><br />If you are using the Tor Browser Bundle then you have to prevent Vidalia from starting up. This is not covered by this tutorial.<br /><br />If you need to use an application with socks5 proxy support (IRC, Pidgin, ...) you can use 10.0.42.1 port 9001 or port 9002.<br />Socks port 9001 will use the same Tor circuit for all connections for 10 minutes or so.<br />Socks port 9002 will use a different Tor circuit for every new connection.<br /><br />If you want to manually create a new circuit (like &quot;new identity&quot; in Vidalia) then you&#039;ll have to connect to the Raspberry PI with SSH first. This will work from the laptop.<br />Enter &quot;arm&quot; at the command prompt and press &quot;n&quot; to get a new circuit, or &quot;m&quot; for a menu.<br /><br />When James Clapper and General Alexander are knocking on your door while you&#039;re using the Raspberry PI enter &quot;sudo reboot&quot; in the terminal. This should clear the log files from the RAM. <br />Simply turning off the Raspberry PI may leave some residue in the memory chips.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>September 29, 2013, 03:58 pm</strong>
			</dt>
			<dd class="postbody">
				stub
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>astor</strong> on <strong>September 29, 2013, 06:57 pm</strong>
			</dt>
			<dd class="postbody">
				Another great tutorial, Bazille. :)<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>thebakertrio</strong> on <strong>September 29, 2013, 07:02 pm</strong>
			</dt>
			<dd class="postbody">
				+1 and sub, I have three PI boards and could do more with them. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>randomOVDB#2</strong> on <strong>October 01, 2013, 07:52 am</strong>
			</dt>
			<dd class="postbody">
				How is this different from the Grugq&#039;s PORTAL aside from using Pi?
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>October 01, 2013, 09:27 am</strong>
			</dt>
			<dd class="postbody">
				I don&#039;t know PORTAL. Does it prevent permanent logging of MAC addresses after rebooting? Does it make your computer use a transparent Tor proxy which can provide the exit node with too much information when not being careful? Does it use a self-compiled latest development version of Tor? Does it use tlsdate to fetch the time securely?<br /><br />With this system you will also be able to easily update the software packges You don&#039;t have to flash the device again. Instead you simply do apt-get update &amp;&amp; apt-get dist-upgrade. Though that&#039;s not really necessary. PORTAL&nbsp; looked like it wasn&#039;t updated since 2012 when I searched for it last week. You can also easily make a backup of your whole system by reading the SD card with Win32 Disk Imager.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>October 01, 2013, 10:31 am</strong>
			</dt>
			<dd class="postbody">
				The tutorial has been updated. /tmp gets the right permissions in rc.local. The WPA passphrase length has been increased to minimum length. /var/log/messages has been moved to the ram disk.<br />DHCP server now offers time server to connecting clients and the firewall port has been opened.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>MrVidalia</strong> on <strong>October 01, 2013, 07:17 pm</strong>
			</dt>
			<dd class="postbody">
				I haven&#039;t fully analised it all but on the surface it appears sound.<br /><br />However your configuration is for WPA with TKIP. TKIP should be considered as secure as un-encrypted wifi! Please use WPA2 + AES instead. Even better would be not to buy a USB WiFi but instead to buy a USB ethernet as wifi can be captured over the air, replayed and brute forced.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>randomOVDB#2</strong> on <strong>October 01, 2013, 07:42 pm</strong>
			</dt>
			<dd class="postbody">
				Latest change in PORTAL was done in 2013 and PORTALofPi came out a month ago.<br />https://github.com/grugq/portal<br />https://github.com/grugq/PORTALofPi<br /><br />I&#039;m not trying to downplay your contributions (on the contrary, I find them very valuable), I&#039;m just interested in the differences between the two setups.<br /><br />
			</dd>
			<dt class="postheader">
				Title: <strong>Turn your Raspberry PI into a transparent Tor hotspot</strong><br />
				Post by: <strong>Bazille</strong> on <strong>October 01, 2013, 09:08 pm</strong>
			</dt>
			<dd class="postbody">
				By making these changes to the system you can turn your Raspberry PI into a transparent Tor hotspot.<br /><br />When someone connects to the PI and starts their browser it will redirect them to a landing page where they have to agree to the terms of service.<br />After they agreed it will route all their traffic transparently through Tor. If they don&#039;t agree they can still use the Tor proxy as it is described in the above tutorial.<br /><br />You could change the ssid= line in /etc/hostapd/hostapd.conf to something like &quot;Free Inet - password: snowden23&quot; to let everyone in range connect to it.<br />Instead of announcing the password you could also remove the encryption options in /etc/hostapd/hostapd.conf to make it an obviously public hotspot without password and encryption.<br /><br />You could hide it somewhere near a public hotspot and attach a solar power battery pack and another wifi dongle to it to provide free anonymous internet for everyone.<br />The MAC addresses which connected to it will be logged in the ram disk for 1 day only, as the PI will automatically reboot daily.<br /><br />It is assumed that you have already set up the Raspberry PI according to the above tutorial in this thread. If you did not, then you have to make further changes to your system.<br /><br />The method is partly based on the captive portal tutorial from here: http://aryo.info/labs/captive-portal-using-php-and-iptables.html<br /><br />Disclaimer: <br />Making the hotspot password public may create some attack possibilities for scriptkiddies, e.g. they could try to DoS the webserver. <br />Though the webserver itself probably can&#039;t be hacked to gain root access to the system, unless you add more webpages to it.<br />If you installed Privoxy on your system you should uninstall it, because it displays too much information when trying to access a non-existing URL.<br /><br /><br />############################################################################################################<br /><br /><br />1. Dnsmasq and Lighttpd<br /><br />First we install Dnsmasq which will answer all DNS requests with the IP of the Raspberry PI wifi interface.<br /><br />Enter the following lines to install Dnsmasq and configure it:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">apt-get install dnsmasq -y<br />sudo nano /etc/dnsmasq.conf<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Scroll down to the end of the text file and paste<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">address=/#/10.0.42.1<br />interface=wlan0<br />no-resolv<br />no-hosts<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />To provide a landing page and change firewall rules for users who accepted the TOS we need a webserver with PHP support.<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get install lighttpd -y<br />sudo apt-get install php5-common php5-cgi php5 -y<br />sudo lighty-enable-mod fastcgi-php<br />sudo rm /var/www/*<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />To have the landing page displayed to users starting their browser it is necessary to create a 404 error handler which redirects users.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/lighttpd/lighttpd.conf<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Scroll down to the end of the text file and paste<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">server.error-handler-404 = &quot;/404.php&quot;<br />server.tag = &quot;NSA Web Server&quot;<br />dir-listing.activate = &quot;disable&quot;<br /><br />$SERVER[&quot;socket&quot;] == &quot;:443&quot; {<br />&nbsp; &nbsp; &nbsp;ssl.engine = &quot;enable&quot; <br />&nbsp; &nbsp; &nbsp;ssl.pemfile = &quot;/etc/lighttpd/ssl/nsa.pem&quot; <br />}<br /><br />$HTTP[&quot;scheme&quot;] == &quot;https&quot; {<br />&nbsp; &nbsp; $HTTP[&quot;host&quot;] =~ &quot;.*&quot; {<br />&nbsp; &nbsp; &nbsp; &nbsp; url.redirect = (&quot;.*&quot; =&gt; &quot;http://%0$0&quot;)<br />&nbsp; &nbsp; }<br />}<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Change &#039;server.errorlog = &quot;/var/log/lighttpd/error.log&quot;&#039;<br />to server.errorlog = &quot;/tmp/serror.log&quot;<br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />To redirect users whose browser tries to connect to a HTTPS URL we have to create a SSL certificate.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo mkdir /etc/lighttpd/ssl<br />sudo chmod 755 /etc/lighttpd/ssl<br />cd /etc/lighttpd/ssl<br />sudo openssl req -new -x509 -keyout nsa.pem -out nsa.pem -days 9001 -nodes<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press enter to accept default values or change them<br /><br />Enter <br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo chmod 400 nsa.pem</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />To allow the webserver to change the firewall rules it needs to get added to sudoers:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo visudo<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Scroll down to the end of the text file and paste <br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">www-data ALL=NOPASSWD: /sbin/iptables -t nat -I PREROUTING -j MARK*<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />To prevent the webserver to get started before /tmp (ram disk) permissions allow it to create a logfile it needs to get removed from rc.d and added to rc.local<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo update-rc.d lighttpd disable<br />sudo nano /etc/rc.local<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Before &quot;exit 0&quot; add<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">/etc/init.d/lighttpd restart<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />############################################################################################################<br /><br />2. Create the webserver landing pages<br /><br />Users connecting to the hotspot will automatically get redirected to this landing page when they start their browser.<br />The landing page will get their MAC address so it can get added to the firewall rules if they accept the TOS.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /var/www/index.php<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Paste this into the editor:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">&lt;html&gt;&lt;body&gt;&lt;title&gt;Hello? Yes, this is NSA!&lt;/title&gt;<br />&lt;?php<br />// capture their IP address<br />$ip = $_SERVER&#91;&#039;REMOTE_ADDR&#039;];<br /><br />// execute the arp command to get their mac address<br />$mac = shell_exec(&quot;arp -an &quot; . $ip);<br />preg_match(&#039;/..:..:..:..:..:../&#039;,$mac , $matches);<br /><br />$mac = @$matches[0];<br /><br />// if MAC Address couldn&#039;t be identified.<br />if( $mac === NULL) { <br />&nbsp; echo &quot;Access Denied.&quot;;<br />&nbsp; exit;<br />}<br />?&gt;<br />&lt;pre&gt;<br />This is a service which provides connection to the internet through the Tor anonymity network.<br /><br />You are not directly connected to the internet, instead the connection gets routed through random nodes in various countries.<br />Connections can sometimes be slow. If a connection times out simply reload the webpage.<br /><br />###################################################################################################################<br /><br />Do not use this service for illegal activity<br />Do not send sensitive data unless you are 100% sure the connection to the webserver is encrypted<br />Do not use this service for filesharing or puppies will die<br /><br />###################################################################################################################<br /><br />Before using this free service you have to agree to sell your soul.<br /><br />Do you accept the deal?<br /><br />&lt;/pre&gt;<br />&lt;form method=&quot;post&quot; action=&quot;process.php&quot;&gt;<br />&nbsp; &lt;input type=&quot;hidden&quot; name=&quot;mac&quot; value=&quot;&lt;?php echo $mac; ?&gt;&quot; /&gt;<br />&nbsp; &lt;input type=&quot;hidden&quot; name=&quot;ip&quot; value=&quot;&lt;?php echo $ip; ?&gt;&quot; /&gt;<br />&nbsp; &lt;input type=&quot;submit&quot; value=&quot;YAY!&quot; style=&quot;padding:10px 20px;&quot; /&gt;<br />&lt;/form&gt;<br />&lt;/body&gt;&lt;/html&gt;<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter <br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /var/www/process.php<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Paste this into the editor:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">&lt;html&gt;&lt;body&gt;<br />&lt;?php <br />if( isset($_POST&#91;&#039;ip&#039;] ) &amp;&amp; isset ( $_POST&#91;&#039;mac&#039;] ) ) {<br />&nbsp; &nbsp;$ip = $_POST&#91;&#039;ip&#039;];<br />&nbsp; &nbsp;$mac = $_POST&#91;&#039;mac&#039;];<br />&nbsp; &nbsp;exec(&quot;sudo iptables -t nat -I PREROUTING -j MARK --set-mark 42 -i wlan0 -m mac --mac-source $mac&quot;);<br />} else {<br />&nbsp; &nbsp;echo &quot;Access Denied&quot;; <br />&nbsp; &nbsp;exit;<br />}<br />?&gt;<br />&lt;pre&gt;<br />Your computer is now connected to the internet through the Tor anonymity network.<br /><br />Optionally you can connect to .onion websites (&quot;Darknet&quot;). <br />You can find Onion links on Reddit:<br />&lt;a href=&quot;http://www.reddit.com/r/onions&quot;&gt;http://www.reddit.com/r/onions&lt;/a&gt;<br /><br />With best regards,<br /><br />Keith the General Alexander<br />&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /var/www/404.php<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />and paste<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">&lt;?php<br />header(&quot;Location: http://10.0.42.1/&quot;, TRUE, 303);<br />exit;<br />?&gt;<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br /><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo chown -R www-data:www-data /var/www<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />to make sure the webserver is the owner of the .php files.<br /><br />############################################################################################################<br /><br />3. Tor configuration<br /><br />Tor needs some additional configuration options to transparently tunnel all connections from wifi clients through Tor.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/tor/torrc<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Scroll down to the end of the text file and paste these lines:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">VirtualAddrNetwork 10.23.0.0/10 <br />AutomapHostsOnResolve 1<br />TransPort 9040<br />TransListenAddress 10.0.42.1<br />DNSPort 5553<br />DNSListenAddress 10.0.42.1<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />############################################################################################################<br /><br />4. Firewall<br /><br />The firewall script needs some additional lines to accept DNS and http connections from the wifi clients.<br />It will redirect every data packet marked with 42 to the transparent Tor proxy.<br />The process.php script we created earlier marks all connections from those MAC addresses which accepted the TOS with 42.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">nano /home/pi/firewall<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Below &quot;iptables -F&quot; add<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">iptables -t nat -F</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Before &quot;iptables -L -v&quot; paste these lines:<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">iptables -A INPUT -p tcp -m multiport --dports 80,443 -j ACCEPT # connections to lighttpd<br />iptables -A INPUT -i wlan0 -p udp --dport 53 -j ACCEPT&nbsp; # connections to dnsmasq<br />iptables -A INPUT -p udp --dport 5553 -j ACCEPT&nbsp; # connections to Tor DNSPort<br />iptables -A INPUT -p tcp --dport 9040 -j ACCEPT&nbsp; # connections to Tor TransPort<br /><br /># redirect DNS requests and TCP traffic from wifi clients which accepted the TOS (mark 42)<br />iptables -t nat -A PREROUTING -i wlan0 -p udp -m mark --mark 42 --dport 53 -j REDIRECT --to-ports 5553 <br />iptables -t nat -A PREROUTING -i wlan0 -p tcp -m mark --mark 42 --syn -j REDIRECT --to-ports 9040 <br /><br /># prevent flooding of lighttpd - allow 5 new connections per IP in 10 seconds<br />iptables -I INPUT -p tcp --dport 80 -i wlan0 -m state --state NEW -m recent --set<br />iptables -I INPUT -p tcp --dport 80 -i wlan0 -m state --state NEW -m recent --update --seconds 10 --hitcount 5 -j DROP<br /><br /># prevent flooding of dnsmasq/Tor DNS - allow 20 new connections per IP in 10 seconds<br />iptables -I INPUT -p udp -m multiport --dports 53,5553 -i wlan0 -m state --state NEW -m recent --set<br />iptables -I INPUT -p udp -m multiport --dports 53,5553 -i wlan0 -m state --state NEW -m recent --update --seconds 10 --hitcount 20 -j DROP<br /><br /># probably not necessary: drop dnsmasq connections through ethernet<br />iptables -A OUTPUT -o eth0 ! -d $LOCALNET/24 -j DROP -m owner --uid-owner dnsmasq<br /><br /># drop connections to lighttpd from users who accepted TOS<br />iptables -I INPUT -i wlan0 -p tcp -m mark --mark 42 -m state --state NEW -m multiport --dports 80,443 -j DROP <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter this line to update the firewall<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo /home/pi/firewall</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />############################################################################################################<br /><br />5. Daily reboot<br /><br />To clear the previously connected MAC addresses from the ram disk we automatically reboot the Raspberry PI daily.<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo nano /etc/cron.daily/reboot</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />and paste<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">#!/bin/sh<br />reboot<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Press CTRL-X to save the changes, enter y and press enter to confirm the filename<br /><br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo chmod 755 /etc/cron.daily/reboot</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />############################################################################################################<br /><br />6. Done<br /><br />If you want to provide public access to Tor you should remove the Privoxy proxy, because it can display too much information about the system when someone connects to it.<br />Enter<br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo apt-get remove privoxy<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Enter <br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">sudo reboot</blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />to reboot the Raspberry PI. After 30 seconds you can connect your laptop via wifi and test the connection.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>October 01, 2013, 09:12 pm</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=215782.msg1579018#msg1579018">Quote from: MrVidalia on October 01, 2013, 07:17 pm</a></div></div><blockquote class="bbc_standard_quote">However your configuration is for WPA with TKIP. TKIP should be considered as secure as un-encrypted wifi! Please use WPA2 + AES instead. <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />I think the TKIP option doesn&#039;t even get used, because the AP runs on wpa2. So only CCMP should be used. Or it&#039;s optional. Anyway I simply copied that part from another tutorial. Will test it and remove the option if it still works.<br /><br /><div class="quoteheader"><div class="topslice_quote">Quote</div></div><blockquote class="bbc_standard_quote">Even better would be not to buy a USB WiFi but instead to buy a USB ethernet as wifi can be captured over the air, replayed and brute forced.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />True, but some people may want to connect their smartphones to it.
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>October 01, 2013, 09:47 pm</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=215782.msg1579060#msg1579060">Quote from: randomOVDB#2 on October 01, 2013, 07:42 pm</a></div></div><blockquote class="bbc_standard_quote">Latest change in PORTAL was done in 2013 and PORTALofPi came out a month ago.<br />https://github.com/grugq/portal<br />https://github.com/grugq/PORTALofPi<br /><br />I&#039;m not trying to downplay your contributions (on the contrary, I find them very valuable), I&#039;m just interested in the differences between the two setups.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Apparently PORTAL uses NTP for time synchronization, which an attacker could use to deanonymize you by feeding your system the wrong time. Though that attack may never get used by anyone anyway, and it&#039;s probably useless as the connecting client computer is not affected by it.<br />PORTAL does also not log to the ram disk, so MAC&#039;s which connected to it will be logged permanently, even after reboot. It doesn&#039;t seem to use the latest development version of Tor, and Tor is not self-compiled. <br /><br />Apart from that there don&#039;t seem to be many differences. Those differences may not be very important anyway. I don&#039;t see any significant reason against using PORTAL, but when using it you should replace the installed Tor package with the latest development version.<br /><br />The PORTALofPI executes a shell script to do all configuration for you. That is convenient, but I think doing it all yourself is better for learning and understanding how the system works.<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: Tutorial: Tor on Raspberry PI Wireless Access Point Without Logging</strong><br />
				Post by: <strong>Bazille</strong> on <strong>October 02, 2013, 04:28 pm</strong>
			</dt>
			<dd class="postbody">
				In case this forum gets taken down my tutorials are available on the clearnet.<br />if it happens: see you soon on another marketplace.<br /><br />http://torforum.org/viewtopic.php?f=2&amp;t=18337<br />http://torforum.org/viewtopic.php?f=2&amp;t=18324<br />http://torforum.org/viewtopic.php?f=2&amp;t=18320<br /><br />
			</dd>
		</dl>
		<div id="footer" class="smalltext">
			
			<span class="smalltext" style="display: inline; visibility: visible; font-family: Verdana, Arial, sans-serif;"><a href="http://dkn255hz262ypmii.onion/index.php?action=credits" title="Simple Machines Forum" target="_blank" class="new_win">SMF 2.0.5</a> |
 <a href="http://www.simplemachines.org/about/smf/license.php" title="License" target="_blank" class="new_win">SMF &copy; 2013</a>, <a href="http://www.simplemachines.org" title="Simple Machines" target="_blank" class="new_win">Simple Machines</a>
			</span>
		</div>
	</body>
</html>