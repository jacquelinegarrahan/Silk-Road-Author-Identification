<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="robots" content="noindex" />
		<link rel="canonical" href="http://dkn255hz262ypmii.onion/index.php?topic=42923.0" />
		<title>Print Page - GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</title>
		<style type="text/css">
			body, a
			{
				color: #000;
				background: #fff;
			}
			body, td, .normaltext
			{
				font-family: Verdana, arial, helvetica, serif;
				font-size: small;
			}
			h1#title
			{
				font-size: large;
				font-weight: bold;
			}
			h2#linktree
			{
				margin: 1em 0 2.5em 0;
				font-size: small;
				font-weight: bold;
			}
			dl#posts
			{
				width: 90%;
				margin: 0;
				padding: 0;
				list-style: none;
			}
			dt.postheader
			{
				border: solid #000;
				border-width: 1px 0;
				padding: 4px 0;
			}
			dd.postbody
			{
				margin: 1em 0 2em 2em;
			}
			table
			{
				empty-cells: show;
			}
			blockquote, code
			{
				border: 1px solid #000;
				margin: 3px;
				padding: 1px;
				display: block;
			}
			code
			{
				font: x-small monospace;
			}
			blockquote
			{
				font-size: x-small;
			}
			.smalltext, .quoteheader, .codeheader
			{
				font-size: x-small;
			}
			.largetext
			{
				font-size: large;
			}
			.centertext
			{
				text-align: center;
			}
			hr
			{
				height: 1px;
				border: 0;
				color: black;
				background-color: black;
			}
		</style>
	</head>
	<body>
		<h1 id="title">Silk Road forums</h1>
		<h2 id="linktree">Discussion => Security => Topic started by: LouisCyphre on September 15, 2012, 02:43 am</h2>
		<dl id="posts">
			<dt class="postheader">
				Title: <strong>GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 15, 2012, 02:43 am</strong>
			</dt>
			<dd class="postbody">
				Hello,<br /><br />Today I am going to show how to modify GPG 1.4.12 and compile it on *nix systems (Linux, BSD, OS X, etc.).&nbsp; First, though, some important disclaimers:<br /><br />* This is NOT recommended by Werner Koch, the creator of GPG.<br /><br />* Use of keys larger than 4096-bit is NOT recommended by anyone in the GPG development and general use community because larger keys may not work with all people, devices or OpenPGP implementations.<br /><br />* There is a noticable CPU performance hit when creating and using 8192-bit keys or larger.<br /><br />* The future of OpenPGP is to switch to ECC from RSA and Elgamal in the coming years to provide comparable cryptographic strength to symmetric ciphers with smaller keys.<br /><br />* If you are new to GPG or Linux/BSD/UNIX then you SHOULD NOT do this until you understand what it is actually doing.<br /><br />If you still want to create keys that are larger than the current 4096-bit maximum, then this is how you do it.&nbsp; These instructions assume you are using a *nix system on which you have root access.&nbsp; The instructions will include compiling in support for the old IDEA cipher, for backwards compatibility with data encrypted during the 1990s.<br /><br />This tutorial assumes you are familiar with a UNIX shell (e.g. bash) and use of a real text editor (e.g. Emacs or Vim).<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">cd /tmp/<br />wget -t 0 -c ftp://ftp.gnupg.org/gcrypt/gnupg/gnupg-1.4.12.tar.bz2<br />wget -t 0 -c ftp://ftp.gnupg.dk/contrib-dk/idea.c.gz<br />gunzip idea.c.gz<br />su -<br /></code><br />At this point you will be prompted for the root password.&nbsp; Enter it.&nbsp; Alternatively you can use:<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">sudo bash</code><br />Using sudo to get a bash prompt may be preferable on Ubuntu and OS X systems which do not enable root access by default.<br /><br />Be EXTREMELY careful from this point on because root access enables you to do anything on your system (unless you&#039;re using SELinux or similar mandatory access controls).<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">cd /usr/local/src<br />cp /tmp/gnupg-1.4.12.tar.bz2 .<br />tar -xjvf gnupg-1.4.12.tar.bz2<br />cd gnupg-1.4.12/<br />cd cipher/<br />cp /tmp/idea.c .<br />rm -f idea-stub.c<br />cd ../g10/<br /></code><br />At this point you will need to open a file with your preferred text editor, e.g. Vim or Emacs.<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">vim keygen.c</code><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">emacs keygen.c</code><br />In the text editor skip down to line number 1,580 (you can also search for &quot;4096&quot; to reach the same point).<br /><br />Replace this line:<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">&nbsp; unsigned nbits, min, def=2048, max=4096;<br /></code><br />With this:<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">&nbsp; unsigned nbits, min, def=2048, max=16384;<br /></code><br />Then save the file and return to the parent directory.<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">cd .. </code><br />Then just configure, make and make install.&nbsp; By default it will install to /usr/local/ directories.&nbsp; If you already have a version of GPG in there that you don&#039;t want to mess with then you should select another prefix and eprefix (e.g. --prefix=/opt/local --eprefix=/opt/local).<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">./configure --enable-idea --enable-camellia<br />make<br />make install<br /></code><br />That&#039;s it, you should now exit out of root or superuser access.<br /><br />You will now have a /usr/local/bin/gpg executable which is capable of creating 16384-bit keys.<br /><br />You should make sure your gpg.conf is configured as per the instructions here:<br /><br />http://dkn255hz262ypmii.onion/index.php?topic=34204.0<br /><br />Then use expert mode to create a new key as described here:<br /><br />http://dkn255hz262ypmii.onion/index.php?topic=28474.0<br /><br />When you are prompted to select your key size, you will be able to enter any value up to and including 16,384 bits.<br /><br />Most systems will not have any trouble creating keys with 8,192 bits of strength, but some will have real trouble creating keys larger than that.&nbsp; Usually they will complain that they have run out of secure memory when that occurs.<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 15, 2012, 08:30 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466796#msg466796">Quote from: Guru on September 15, 2012, 08:02 am</a></div></div><blockquote class="bbc_standard_quote">Couple of minor nit-picks: <br /><br />First off, the site with the idea.c source code appears to be down. Not sure if this is temporary, or by design. <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />I must admit, I didn&#039;t check it because I last did all this shortly after 1.4.12 was released and I didn&#039;t feel like recompiling just for the guide.<br /><br /><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466796#msg466796">Quote from: Guru on September 15, 2012, 08:02 am</a></div></div><blockquote class="bbc_standard_quote">Second, in addition to the idea.c.gz package, you should also have reminded the user to download/verify the PGP detached signature: <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Yep, my bad.<br /><br />Did you manage to find a copy or did you already have it?&nbsp; If it&#039;s still not accessible I can post it.<br /><br /><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466796#msg466796">Quote from: Guru on September 15, 2012, 08:02 am</a></div></div><blockquote class="bbc_standard_quote">Third, it does not appear to be necessary to use the --enable-idea and --enable-camellia switches.&nbsp; Compiling in the usual manner without these switches (at least in my case) nevertheless shows both IDEA and Camellia enabled: <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Using --enable-idea is probably unnecessary, but --help still shows that --camellia should be explicitly enabled.&nbsp; That does seem to vary with the versions for some distributions.&nbsp; It&#039;s also possible that Camellia is now enabled by default, but the configure help info has not been updated to reflect that.<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 15, 2012, 08:38 am</strong>
			</dt>
			<dd class="postbody">
				of course you should make sure to torify wget before doing this 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 15, 2012, 08:43 am</strong>
			</dt>
			<dd class="postbody">
				I don&#039;t see why you ask users to wget idea.c considering that has to do with symmetric encryption and I can not in the slightest think of why users would need to do anything with that to change the maximum asymmetric key strength. However if users wget that file without torifying wget they will leak their real IP address when they wget both gnupg-1.4.12.tar.bz2 and idea.c.gz, and I imagine that will be a pretty small crowd of people considering I doubt that barely anyone downloads that combination of files in such a way. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 15, 2012, 08:46 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466829#msg466829">Quote from: kmfkewm on September 15, 2012, 08:38 am</a></div></div><blockquote class="bbc_standard_quote">of course you should make sure to torify wget before doing this<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Good point.&nbsp; For everyone else, fire up the Vidalia Bundle and then add these lines to ~/.wgetrc:<br /><br />https_proxy = http://127.0.0.1:8118/<br />http_proxy = http://127.0.0.1:8118/<br />ftp_proxy = http://127.0.0.1:8118/<br /><br />Although personally I cheat and have a couple of shell scripts, one has:<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">#!/bin/sh<br /><br />exec /usr/local/bin/wget --execute=http_proxy=127.0.0.1:8118 -t 0 -c &quot;$@&quot;<br /></code><br />And the other has:<br /><br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">#!/bin/sh<br /><br />exec /usr/local/bin/wget --execute=http_proxy=127.0.0.1:8118 --no-check-certificate -t 0 -c &quot;$@&quot;<br /></code><br />Make sure the path for wget is correct for your system before using the above.<br /><br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 15, 2012, 08:50 am</strong>
			</dt>
			<dd class="postbody">
				Okay problem solved :) 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 15, 2012, 08:50 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466833#msg466833">Quote from: kmfkewm on September 15, 2012, 08:43 am</a></div></div><blockquote class="bbc_standard_quote">I don&#039;t see why you ask users to wget idea.c considering that has to do with symmetric encryption and I can not in the slightest think of why users would need to do anything with that to change the maximum asymmetric key strength. However if users wget that file without torifying wget they will leak their real IP address when they wget both gnupg-1.4.12.tar.bz2 and idea.c.gz, and I imagine that will be a pretty small crowd of people considering I doubt that barely anyone downloads that combination of files in such a way.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Old habits.&nbsp; IDEA is pretty optional and there probably aren&#039;t many people here who have to worry about decrypting old files that were encrypted before it was removed.<br /><br />It may give some idea how long I&#039;ve been doing this.&nbsp; Like Guru, I remember the Crypto Wars and I&#039;m convinced that they&#039;ve restarted (or that the &quot;official&quot; announcement that they ended may have been premature).<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 15, 2012, 08:56 am</strong>
			</dt>
			<dd class="postbody">
				In case there is trouble with the FTP server with the IDEA cipher and people do want to include it, here&#039;s the copy I&#039;ve obtained previously.<br /><br />idea.c:<br /><div class="codeheader">Code: <a href="javascript:void(0);" onclick="return smfSelectText(this);" class="codeoperation">[Select]</a></div><code class="bbc_code">/* idea.c&nbsp; -&nbsp; IDEA algorithm<br />&nbsp;* Copyright (c) 1997, 1998, 1999, 2001, 2002 by Werner Koch (dd9jn)<br />&nbsp;*<br />&nbsp;* Permission is hereby granted, free of charge, to any person obtaining a<br />&nbsp;* copy of this software and associated documentation files (the &quot;Software&quot;),<br />&nbsp;* to deal in the Software without restriction, including without limitation<br />&nbsp;* the rights to use, copy, modify, merge, publish, distribute, sublicense,<br />&nbsp;* and/or sell copies of the Software, and to permit persons to whom the<br />&nbsp;* Software is furnished to do so, subject to the following conditions:<br />&nbsp;*<br />&nbsp;* The above copyright notice and this permission notice shall be included in<br />&nbsp;* all copies or substantial portions of the Software.<br />&nbsp;*<br />&nbsp;* THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br />&nbsp;* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br />&nbsp;* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.&nbsp; IN NO EVENT SHALL<br />&nbsp;* WERNER KOCH BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER<br />&nbsp;* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN<br />&nbsp;* CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.<br />&nbsp;*<br />&nbsp;* Except as contained in this notice, the name of Werner Koch shall not be<br />&nbsp;* used in advertising or otherwise to promote the sale, use or other dealings<br />&nbsp;* in this Software without prior written authorization from Werner Koch.<br />&nbsp;*<br />&nbsp;* DUE TO PATENT CLAIMS THE DISTRIBUTION OF THE SOFTWARE IS NOT ALLOWED IN<br />&nbsp;* THESE COUNTRIES: <br />&nbsp;*&nbsp; &nbsp; &nbsp;AUSTRIA, FRANCE, GERMANY, ITALY, JAPAN, THE NETHERLANDS, <br />&nbsp;*&nbsp; &nbsp; &nbsp;SPAIN, SWEDEN, SWITZERLAND, THE UK AND THE US.<br />&nbsp;*/<br /><br />/*<br />&nbsp;* Please see http://www.noepatents.org/ to learn why software patents<br />&nbsp;* are bad for society and what you can do to fight them.<br />&nbsp;*<br />&nbsp;* The code herein is based on the one from:<br />&nbsp;*&nbsp; &nbsp;Bruce Schneier: Applied Cryptography. John Wiley &amp; Sons, 1996.<br />&nbsp;*&nbsp; &nbsp; ISBN 0-471-11709-9. .<br />&nbsp;*<br />&nbsp;* To build a GnuPG with IDEA support, copy this file into the cipher/<br />&nbsp;* directory of the gnupg distribution, and ./configure and make as<br />&nbsp;* usual.&nbsp; IDEA will be built directly in to the GnuPG binary.&nbsp; This<br />&nbsp;* is the recommended way to use this file.<br />&nbsp;*<br />&nbsp;* If you are not building IDEA directly into GnuPG, and need to build<br />&nbsp;* the dynamically loadable IDEA module, compile with:<br />&nbsp; &nbsp; &nbsp; &nbsp;gcc -Wall -O2 -shared -fPIC -o idea idea.c<br />&nbsp;*<br />&nbsp;* If you building the dynamically loadable IDEA module on a bigendian<br />&nbsp;* platform (Sparc, PowerPC, etc.) and the endian detection does not<br />&nbsp;* work properly for whatever reason, you will get an error like &quot;idea<br />&nbsp;* encryption (0) failed&quot; when you use GnuPG.&nbsp; In that case, compile<br />&nbsp;* with:<br />&nbsp; &nbsp; &nbsp; &nbsp;gcc -Wall -O2 -shared -fPIC -DBIG_ENDIAN_HOST -o idea idea.c<br />&nbsp;*<br />&nbsp;* How to build a Windows DLL using mingw32/cpd (see gnupg/doc/README.W32):<br />&nbsp; &nbsp; &nbsp; &nbsp;echo EXPORTS &gt;temp.def ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;echo &quot;&nbsp; &nbsp; idea_get_info&quot; &gt;&gt;temp.def ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;mingw32 gcc -c idea.c ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;mingw32 dlltool -e temp.o&nbsp; --as `mingw32 --get-path as` \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--def temp.def&nbsp; idea.o ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;mingw32 gcc -mdll -Wl,--base-file -Wl,temp.base \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-o idea.dll temp.o idea.o ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;mingw32 dlltool -e temp.o&nbsp; --as `mingw32 --get-path as` \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--def temp.def --base-file temp.base idea.o ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;mingw32 gcc -mdll -o idea.dll temp.o idea.o ; \<br />&nbsp; &nbsp; &nbsp; &nbsp;mingw32 strip idea.dll<br />&nbsp;*<br />&nbsp;* 2001-06-08 wk&nbsp; Changed distribution conditions<br />&nbsp;* 2001-06-11 wk&nbsp; Fixed invert_key (which is not used in CFB mode) <br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Thanks to Mark A. Borgerding.&nbsp; Added definition for<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the PowerPC.<br />&nbsp;* 2002-08-03 wk&nbsp; Removed dependeny to g10_log_fatal and perform selftest<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in idea_get_info.<br />&nbsp;* 2002-08-07 wk&nbsp; Removed unused macros and types etc.<br />&nbsp;* 2002-09-13 wk&nbsp; Explained how to build a Windows DLL.<br />&nbsp;* 2002-09-20 wk&nbsp; Made the DLL relocatable<br />&nbsp;* 2002-12-11 wk&nbsp; __ppc__ is used on Darwin instead of __powerpc__.<br />&nbsp;* 2003-02-15 dshaw Try and get endianness from config.h.&nbsp; Accept<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __sparc and _POWER.<br />&nbsp;*/<br /><br />#ifdef HAVE_CONFIG_H<br />/* If we&#039;re building as part of GnuPG, we can get endianness from<br />&nbsp; &nbsp;config.h */<br />#include &lt;config.h&gt;<br />#endif<br /><br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br />#include &lt;assert.h&gt;<br /><br />#if !defined(BIG_ENDIAN_HOST) &amp;&amp; !defined(LITTLE_ENDIAN_HOST)<br />/* Try to handle endianness if we didn&#039;t get it from config.h */<br />#if defined(__mc68000__) || defined (__sparc__) || defined (__sparc) \<br />&nbsp; &nbsp; || (defined(__mips__) &amp;&amp; (defined(MIPSEB) || defined (__MIPSEB__)) ) \<br />&nbsp; &nbsp; || defined (__PPC__) || defined(__powerpc__) || defined(__ppc__) \<br />&nbsp; &nbsp; || defined (_POWER) \<br />&nbsp; &nbsp; || defined(__hpux__) /* should be replaced by the Macro for the PA */<br />&nbsp; #define BIG_ENDIAN_HOST 1<br />#else<br />&nbsp; #define LITTLE_ENDIAN_HOST 1<br />#endif<br />#endif<br /><br />typedef unsigned short u16; /* Note: Make sure this is a 16 bit type. */<br />typedef unsigned long&nbsp; u32; /* Note: Make sure this is a 32 bit type. */<br /><br />/* end configurable stuff */<br /><br /><br />#ifndef DIM<br />&nbsp; #define DIM(v) (sizeof(v)/sizeof((v)[0]))<br />#endif<br /><br /><br />/* local stuff */<br /><br />#define FNCCAST_SETKEY(f)&nbsp; &nbsp;((int(*)(void*, unsigned char*, unsigned int))(f))<br />#define FNCCAST_CRYPT(f) ((void(*)(void*, unsigned char*, unsigned char*))(f))<br /><br />#define IDEA_KEYSIZE 16<br />#define IDEA_BLOCKSIZE 8<br />#define IDEA_ROUNDS 8<br />#define IDEA_KEYLEN (6*IDEA_ROUNDS+4)<br /><br />typedef struct {<br />&nbsp; &nbsp; u16 ek[IDEA_KEYLEN];<br />&nbsp; &nbsp; u16 dk[IDEA_KEYLEN];<br />&nbsp; &nbsp; int have_dk;<br />} IDEA_context;<br /><br /><br />static int do_setkey( IDEA_context *c, unsigned char *key, unsigned keylen );<br />static void encrypt_block( IDEA_context *bc, unsigned char *outbuf,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsigned char *inbuf );<br />static void decrypt_block( IDEA_context *bc, unsigned char *outbuf,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsigned char *inbuf );<br />static int selftest(int);<br /><br /><br /><br />static u16<br />mul_inv( u16 x )<br />{<br />&nbsp; &nbsp; u16 t0, t1;<br />&nbsp; &nbsp; u16 q, y;<br /><br />&nbsp; &nbsp; if( x &lt; 2 )<br /><span style="white-space: pre;">	</span>return x;<br />&nbsp; &nbsp; t1 = 0x10001L / x;<br />&nbsp; &nbsp; y =&nbsp; 0x10001L % x;<br />&nbsp; &nbsp; if( y == 1 )<br /><span style="white-space: pre;">	</span>return (1-t1) &amp; 0xffff;<br /><br />&nbsp; &nbsp; t0 = 1;<br />&nbsp; &nbsp; do {<br /><span style="white-space: pre;">	</span>q = x / y;<br /><span style="white-space: pre;">	</span>x = x % y;<br /><span style="white-space: pre;">	</span>t0 += q * t1;<br /><span style="white-space: pre;">	</span>if( x == 1 )<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; return t0;<br /><span style="white-space: pre;">	</span>q = y / x;<br /><span style="white-space: pre;">	</span>y = y % x;<br /><span style="white-space: pre;">	</span>t1 += q * t0;<br />&nbsp; &nbsp; } while( y != 1 );<br />&nbsp; &nbsp; return (1-t1) &amp; 0xffff;<br />}<br /><br /><br /><br />static void<br />expand_key( unsigned char *userkey, u16 *ek )<br />{<br />&nbsp; &nbsp; int i,j;<br /><br />&nbsp; &nbsp; for(j=0; j &lt; 8; j++ ) {<br /><span style="white-space: pre;">	</span>ek[j] = (*userkey &lt;&lt; 8) + userkey[1];<br /><span style="white-space: pre;">	</span>userkey += 2;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; for(i=0; j &lt; IDEA_KEYLEN; j++ ) {<br /><span style="white-space: pre;">	</span>i++;<br /><span style="white-space: pre;">	</span>ek[i+7] = ek[i&amp;7] &lt;&lt; 9 | ek[(i+1)&amp;7] &gt;&gt; 7;<br /><span style="white-space: pre;">	</span>ek += i &amp; 8;<br /><span style="white-space: pre;">	</span>i &amp;= 7;<br />&nbsp; &nbsp; }<br />}<br /><br /><br />static void<br />invert_key( u16 *ek, u16 dk[IDEA_KEYLEN] )<br />{<br />&nbsp; &nbsp; int i;<br />&nbsp; &nbsp; u16 t1, t2, t3;<br />&nbsp; &nbsp; u16 temp[IDEA_KEYLEN];<br />&nbsp; &nbsp; u16 *p = temp + IDEA_KEYLEN;<br /><br />&nbsp; &nbsp; t1 = mul_inv( *ek++ );<br />&nbsp; &nbsp; t2 = -*ek++;<br />&nbsp; &nbsp; t3 = -*ek++;<br />&nbsp; &nbsp; *--p = mul_inv( *ek++ );<br />&nbsp; &nbsp; *--p = t3;<br />&nbsp; &nbsp; *--p = t2;<br />&nbsp; &nbsp; *--p = t1;<br /><br />&nbsp; &nbsp; for(i=0; i &lt; IDEA_ROUNDS-1; i++ ) {<br /><span style="white-space: pre;">	</span>t1 = *ek++;<br /><span style="white-space: pre;">	</span>*--p = *ek++;<br /><span style="white-space: pre;">	</span>*--p = t1;<br /><br /><span style="white-space: pre;">	</span>t1 = mul_inv( *ek++ );<br /><span style="white-space: pre;">	</span>t2 = -*ek++;<br /><span style="white-space: pre;">	</span>t3 = -*ek++;<br /><span style="white-space: pre;">	</span>*--p = mul_inv( *ek++ );<br /><span style="white-space: pre;">	</span>*--p = t2;<br /><span style="white-space: pre;">	</span>*--p = t3;<br /><span style="white-space: pre;">	</span>*--p = t1;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; t1 = *ek++;<br />&nbsp; &nbsp; *--p = *ek++;<br />&nbsp; &nbsp; *--p = t1;<br /><br />&nbsp; &nbsp; t1 = mul_inv( *ek++ );<br />&nbsp; &nbsp; t2 = -*ek++;<br />&nbsp; &nbsp; t3 = -*ek++;<br />&nbsp; &nbsp; *--p = mul_inv( *ek++ );<br />&nbsp; &nbsp; *--p = t3;<br />&nbsp; &nbsp; *--p = t2;<br />&nbsp; &nbsp; *--p = t1;<br />&nbsp; &nbsp; memcpy(dk, temp, sizeof(temp) );<br />&nbsp; &nbsp; memset(temp, 0, sizeof(temp) );&nbsp; /* burn temp */<br />}<br /><br /><br />static void<br />cipher( unsigned char *outbuf, unsigned char *inbuf, u16 *key )<br />{<br />&nbsp; &nbsp; u16 x1, x2, x3,x4, s2, s3;<br />&nbsp; &nbsp; u16 *in, *out;<br />&nbsp; &nbsp; int r = IDEA_ROUNDS;<br />#define MUL(x,y) \<br /><span style="white-space: pre;">	</span>do {u16 _t16; u32 _t32; <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; if( (_t16 = (y)) ) {<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>if( (x = (x)&amp;0xffff) ) {<span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; _t32 = (u32)x * _t16;<span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; x = _t32 &amp; 0xffff;<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; _t16 = _t32 &gt;&gt; 16;<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; x = ((x)-_t16) + (x&lt;_t16?1:0);&nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>else {<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; x = 1 - _t16;<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>}<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; }<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; else {<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>x = 1 - x;<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; }<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; \<br /><span style="white-space: pre;">	</span>} while(0)<br /><br />&nbsp; &nbsp; in = (u16*)inbuf;<br />&nbsp; &nbsp; x1 = *in++;<br />&nbsp; &nbsp; x2 = *in++;<br />&nbsp; &nbsp; x3 = *in++;<br />&nbsp; &nbsp; x4 = *in;<br />#ifdef LITTLE_ENDIAN_HOST<br />&nbsp; &nbsp; x1 = (x1&gt;&gt;8) | (x1&lt;&lt;8);<br />&nbsp; &nbsp; x2 = (x2&gt;&gt;8) | (x2&lt;&lt;8);<br />&nbsp; &nbsp; x3 = (x3&gt;&gt;8) | (x3&lt;&lt;8);<br />&nbsp; &nbsp; x4 = (x4&gt;&gt;8) | (x4&lt;&lt;8);<br />#endif<br />&nbsp; &nbsp; do {<br /><span style="white-space: pre;">	</span>MUL(x1, *key++);<br /><span style="white-space: pre;">	</span>x2 += *key++;<br /><span style="white-space: pre;">	</span>x3 += *key++;<br /><span style="white-space: pre;">	</span>MUL(x4, *key++ );<br /><br /><span style="white-space: pre;">	</span>s3 = x3;<br /><span style="white-space: pre;">	</span>x3 ^= x1;<br /><span style="white-space: pre;">	</span>MUL(x3, *key++);<br /><span style="white-space: pre;">	</span>s2 = x2;<br /><span style="white-space: pre;">	</span>x2 ^=x4;<br /><span style="white-space: pre;">	</span>x2 += x3;<br /><span style="white-space: pre;">	</span>MUL(x2, *key++);<br /><span style="white-space: pre;">	</span>x3 += x2;<br /><br /><span style="white-space: pre;">	</span>x1 ^= x2;<br /><span style="white-space: pre;">	</span>x4 ^= x3;<br /><br /><span style="white-space: pre;">	</span>x2 ^= s3;<br /><span style="white-space: pre;">	</span>x3 ^= s2;<br />&nbsp; &nbsp; } while( --r );<br />&nbsp; &nbsp; MUL(x1, *key++);<br />&nbsp; &nbsp; x3 += *key++;<br />&nbsp; &nbsp; x2 += *key++;<br />&nbsp; &nbsp; MUL(x4, *key);<br /><br />&nbsp; &nbsp; out = (u16*)outbuf;<br />&nbsp; #ifdef LITTLE_ENDIAN_HOST<br />&nbsp; &nbsp; *out++ = (x1&gt;&gt;8) | (x1&lt;&lt;8);<br />&nbsp; &nbsp; *out++ = (x3&gt;&gt;8) | (x3&lt;&lt;8);<br />&nbsp; &nbsp; *out++ = (x2&gt;&gt;8) | (x2&lt;&lt;8);<br />&nbsp; &nbsp; *out&nbsp; &nbsp;= (x4&gt;&gt;8) | (x4&lt;&lt;8);<br />&nbsp; #else<br />&nbsp; &nbsp; *out++ = x1;<br />&nbsp; &nbsp; *out++ = x3;<br />&nbsp; &nbsp; *out++ = x2;<br />&nbsp; &nbsp; *out&nbsp; &nbsp;= x4;<br />&nbsp; #endif<br />&nbsp; #undef MUL<br />}<br /><br /><br />static int<br />do_setkey( IDEA_context *c, unsigned char *key, unsigned keylen )<br />{<br />&nbsp; &nbsp; assert(keylen == 16);<br />&nbsp; &nbsp; c-&gt;have_dk = 0;<br />&nbsp; &nbsp; expand_key( key, c-&gt;ek );<br />&nbsp; &nbsp; invert_key( c-&gt;ek, c-&gt;dk );<br />&nbsp; &nbsp; return 0;<br />}<br /><br />static void<br />encrypt_block( IDEA_context *c, unsigned char *outbuf, unsigned char *inbuf )<br />{<br />&nbsp; &nbsp; cipher( outbuf, inbuf, c-&gt;ek );<br />}<br /><br />static void<br />decrypt_block( IDEA_context *c, unsigned char *outbuf, unsigned char *inbuf )<br />{<br />&nbsp; &nbsp; if( !c-&gt;have_dk ) {<br />&nbsp; &nbsp; &nbsp; &nbsp;c-&gt;have_dk = 1;<br />&nbsp; &nbsp; &nbsp; &nbsp;invert_key( c-&gt;ek, c-&gt;dk );<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; cipher( outbuf, inbuf, c-&gt;dk );<br />}<br /><br /><br />static int<br />selftest( int check_decrypt )<br />{<br />static struct {<br />&nbsp; &nbsp; unsigned char key[16];<br />&nbsp; &nbsp; unsigned char plain[8];<br />&nbsp; &nbsp; unsigned char cipher[8];<br />} test_vectors&#91;] = {<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x00, 0x00, 0x00, 0x01, 0x00, 0x02, 0x00, 0x03 },<br />&nbsp; &nbsp; &nbsp; { 0x11, 0xFB, 0xED, 0x2B, 0x01, 0x98, 0x6D, 0xE5 } },<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x54, 0x0E, 0x5F, 0xEA, 0x18, 0xC2, 0xF8, 0xB1 } },<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x00, 0x19, 0x32, 0x4B, 0x64, 0x7D, 0x96, 0xAF },<br />&nbsp; &nbsp; &nbsp; { 0x9F, 0x0A, 0x0A, 0xB6, 0xE1, 0x0C, 0xED, 0x78 } },<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0xF5, 0x20, 0x2D, 0x5B, 0x9C, 0x67, 0x1B, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0xCF, 0x18, 0xFD, 0x73, 0x55, 0xE2, 0xC5, 0xC5 } },<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0xFA, 0xE6, 0xD2, 0xBE, 0xAA, 0x96, 0x82, 0x6E },<br />&nbsp; &nbsp; &nbsp; { 0x85, 0xDF, 0x52, 0x00, 0x56, 0x08, 0x19, 0x3D } },<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x0A, 0x14, 0x1E, 0x28, 0x32, 0x3C, 0x46, 0x50 },<br />&nbsp; &nbsp; &nbsp; { 0x2F, 0x7D, 0xE7, 0x50, 0x21, 0x2F, 0xB7, 0x34 } },<br />&nbsp; &nbsp; { { 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00, 0x04,<br /><span style="white-space: pre;">	</span>0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x05, 0x0A, 0x0F, 0x14, 0x19, 0x1E, 0x23, 0x28 },<br />&nbsp; &nbsp; &nbsp; { 0x7B, 0x73, 0x14, 0x92, 0x5D, 0xE5, 0x9C, 0x09 } },<br />&nbsp; &nbsp; { { 0x00, 0x05, 0x00, 0x0A, 0x00, 0x0F, 0x00, 0x14,<br /><span style="white-space: pre;">	</span>0x00, 0x19, 0x00, 0x1E, 0x00, 0x23, 0x00, 0x28 },<br />&nbsp; &nbsp; &nbsp; { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x3E, 0xC0, 0x47, 0x80, 0xBE, 0xFF, 0x6E, 0x20 } },<br />&nbsp; &nbsp; { { 0x3A, 0x98, 0x4E, 0x20, 0x00, 0x19, 0x5D, 0xB3,<br /><span style="white-space: pre;">	</span>0x2E, 0xE5, 0x01, 0xC8, 0xC4, 0x7C, 0xEA, 0x60 },<br />&nbsp; &nbsp; &nbsp; { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0x97, 0xBC, 0xD8, 0x20, 0x07, 0x80, 0xDA, 0x86 } },<br />&nbsp; &nbsp; { { 0x00, 0x64, 0x00, 0xC8, 0x01, 0x2C, 0x01, 0x90,<br /><span style="white-space: pre;">	</span>0x01, 0xF4, 0x02, 0x58, 0x02, 0xBC, 0x03, 0x20 },<br />&nbsp; &nbsp; &nbsp; { 0x05, 0x32, 0x0A, 0x64, 0x14, 0xC8, 0x19, 0xFA },<br />&nbsp; &nbsp; &nbsp; { 0x65, 0xBE, 0x87, 0xE7, 0xA2, 0x53, 0x8A, 0xED } },<br />&nbsp; &nbsp; { { 0x9D, 0x40, 0x75, 0xC1, 0x03, 0xBC, 0x32, 0x2A,<br /><span style="white-space: pre;">	</span>0xFB, 0x03, 0xE7, 0xBE, 0x6A, 0xB3, 0x00, 0x06 },<br />&nbsp; &nbsp; &nbsp; { 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08 },<br />&nbsp; &nbsp; &nbsp; { 0xF5, 0xDB, 0x1A, 0xC4, 0x5E, 0x5E, 0xF9, 0xF9 } }<br />};<br />&nbsp; &nbsp; IDEA_context c;<br />&nbsp; &nbsp; unsigned char buffer[8];<br />&nbsp; &nbsp; int i;<br /><br />&nbsp; &nbsp; for(i=0; i &lt; DIM(test_vectors); i++ ) {<br /><span style="white-space: pre;">	</span>do_setkey( &amp;c, test_vectors[i].key, 16 );<br /><span style="white-space: pre;">	</span>if( !check_decrypt ) {<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; encrypt_block( &amp;c, buffer, test_vectors[i].plain );<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; if( memcmp( buffer, test_vectors[i].cipher, 8 ) )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>fprintf (stderr, &quot;idea encryption (%d) failed\n&quot;, i);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -1;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>else {<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; decrypt_block( &amp;c, buffer, test_vectors[i].cipher );<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; if( memcmp( buffer, test_vectors[i].plain, 8 ) )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br /><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>fprintf (stderr, &quot;idea decryption (%d) failed\n&quot;, i);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return -1;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br /><span style="white-space: pre;">	</span>}<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; return 0;<br />}<br /><br /><br />/****************<br />&nbsp;* Return some information about the algorithm.&nbsp; We need algo here to<br />&nbsp;* distinguish different flavors of the algorithm.<br />&nbsp;* Returns: A pointer to string describing the algorithm or NULL if<br />&nbsp;*<span style="white-space: pre;">	</span>&nbsp; &nbsp; the ALGO is invalid.<br />&nbsp;*/<br />const char *<br />idea_get_info( int algo, size_t *keylen,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;size_t *blocksize, size_t *contextsize,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int<span style="white-space: pre;">	</span>(**r_setkey)( void *c, unsigned char *key,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unsigned keylen ),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;void (**r_encrypt)( void *c, unsigned char *outbuf,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsigned char *inbuf ),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;void (**r_decrypt)( void *c, unsigned char *outbuf,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsigned char *inbuf )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />{<br />&nbsp; &nbsp; static int initialized = 0;<br /><br />&nbsp; &nbsp; if( !initialized ) {<br /><span style="white-space: pre;">	</span>initialized = 1;<br /><span style="white-space: pre;">	</span>if ( selftest(0) || selftest(1) )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return NULL;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; *keylen = 128;<br />&nbsp; &nbsp; *blocksize = 8;<br />&nbsp; &nbsp; *contextsize = sizeof(IDEA_context);<br />&nbsp; &nbsp; *r_setkey = FNCCAST_SETKEY(do_setkey);<br />&nbsp; &nbsp; *r_encrypt= FNCCAST_CRYPT(encrypt_block);<br />&nbsp; &nbsp; *r_decrypt= FNCCAST_CRYPT(decrypt_block);<br />&nbsp; &nbsp; if( algo == 1 )<br /><span style="white-space: pre;">	</span>return &quot;IDEA&quot;;<br />&nbsp; &nbsp; return NULL;<br />}<br /><br /><br /><br />const char * const gnupgext_version = &quot;IDEA ($Revision: 1.11 $)&quot;;<br /><br />static struct {<br />&nbsp; &nbsp; int class;<br />&nbsp; &nbsp; int version;<br />&nbsp; &nbsp; int&nbsp; value;<br />&nbsp; &nbsp; void (*func)(void);<br />} func_table&#91;] = {<br />&nbsp; &nbsp; { 20, 1, 0, (void(*)(void))idea_get_info },<br />&nbsp; &nbsp; { 21, 1, 1 },<br />};<br /><br /><br /><br />/****************<br />&nbsp;* Enumerate the names of the functions together with informations about<br />&nbsp;* this function. Set sequence to an integer with a initial value of 0 and<br />&nbsp;* do not change it.<br />&nbsp;* If what is 0 all kind of functions are returned.<br />&nbsp;* Return values: class := class of function:<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp;10 = message digest algorithm info function<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp;11 = integer with available md algorithms<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp;20 = cipher algorithm info function<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp;21 = integer with available cipher algorithms<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp;30 = public key algorithm info function<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp;31 = integer with available pubkey algorithms<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; version = interface version of the function/pointer<br />&nbsp;*<span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>&nbsp; &nbsp; (currently this is 1 for all functions)<br />&nbsp;*/<br />void *<br />gnupgext_enum_func( int what, int *sequence, int *class, int *vers )<br />{<br />&nbsp; &nbsp; void *ret;<br />&nbsp; &nbsp; int i = *sequence;<br /><br />&nbsp; &nbsp; do {<br /><span style="white-space: pre;">	</span>if( i &gt;= DIM(func_table) || i &lt; 0 ) {<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; return NULL;<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>*class = func_table[i].class;<br /><span style="white-space: pre;">	</span>*vers&nbsp; = func_table[i].version;<br /><span style="white-space: pre;">	</span>switch( *class ) {<br /><span style="white-space: pre;">	</span>&nbsp; case 11:<br /><span style="white-space: pre;">	</span>&nbsp; case 21:<br /><span style="white-space: pre;">	</span>&nbsp; case 31:<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; ret = &amp;func_table[i].value;<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; break;<br /><span style="white-space: pre;">	</span>&nbsp; default:<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; ret = (void*)func_table[i].func;<br /><span style="white-space: pre;">	</span>&nbsp; &nbsp; break;<br /><span style="white-space: pre;">	</span>}<br /><span style="white-space: pre;">	</span>i++;<br />&nbsp; &nbsp; } while( what &amp;&amp; what != *class );<br /><br />&nbsp; &nbsp; *sequence = i;<br />&nbsp; &nbsp; return ret;<br />}<br /></code>
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 15, 2012, 10:29 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466882#msg466882">Quote from: Guru on September 15, 2012, 09:40 am</a></div></div><blockquote class="bbc_standard_quote"><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466824#msg466824">Quote from: LouisCyphre on September 15, 2012, 08:30 am</a></div></div><blockquote class="bbc_alternate_quote"><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466796#msg466796">Quote from: Guru on September 15, 2012, 08:02 am</a></div></div><blockquote class="bbc_standard_quote">Second, in addition to the idea.c.gz package, you should also have reminded the user to download/verify the PGP detached signature: <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Yep, my bad.<br /><br />Did you manage to find a copy or did you already have it?&nbsp; If it&#039;s still not accessible I can post it. </blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />I already had a copy of Werner&#039;s idea.c.gz stashed.&nbsp; I also have a copy of Disastry&#039;s idea.c source as well.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Would it be worth posting that or was it only used with old versions of PGP(i)?<br /><br /><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466882#msg466882">Quote from: Guru on September 15, 2012, 09:40 am</a></div></div><blockquote class="bbc_standard_quote">Disastry (Janis Jagars) will be gone 10 years at the end of October -- it seems like yesterday that I read his obituary.&nbsp; He was as&nbsp; talented as all get out -- he updated the DOS versions of PGP to include the SHA-1, Tiger and Whirlpool hash algorithms, as well as adding DH/DSS capability to it.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />That name sounds very familiar, probably from mailing lists.<br /><br /><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466882#msg466882">Quote from: Guru on September 15, 2012, 09:40 am</a></div></div><blockquote class="bbc_standard_quote">He also cleaned-up the Mixmaster code, I believe with Len Sassaman.&nbsp; Sassaman died earlier this year.&nbsp; (Gawd, I feel old!)<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Yeah, that one was a Hell of a shock, especially given the circumstances.&nbsp; :(<br /><br /><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg466882#msg466882">Quote from: Guru on September 15, 2012, 09:40 am</a></div></div><blockquote class="bbc_standard_quote">I suspect that the help just hasn&#039;t been updated. Camellia has been in there for some time; I&#039;ve been compiling my own, and I&#039;ve never used the --enable-camellia switch, and it&#039;s been there nevertheless. <br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />You&#039;re probably right.&nbsp; That&#039;s certainly the sort of thing that could be easily overlooked, especially with the focus being on 2.0.x and wanting to move from both branches to 2.1.<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>Shannon</strong> on <strong>September 15, 2012, 07:42 pm</strong>
			</dt>
			<dd class="postbody">
				secmem can be ramped up by changing &quot;got_secmem=secmem_init( 32768 );&quot; to &quot;got_secmem=secmem_init( 524288 );&quot; in g10/gpg.c
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 18, 2012, 03:14 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg467389#msg467389">Quote from: Shannon on September 15, 2012, 07:42 pm</a></div></div><blockquote class="bbc_standard_quote">secmem can be ramped up by changing &quot;got_secmem=secmem_init( 32768 );&quot; to &quot;got_secmem=secmem_init( 524288 );&quot; in g10/gpg.c<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Very nice!&nbsp; That one&#039;s going into the archives, thanks!&nbsp; :)<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>Shannon</strong> on <strong>September 18, 2012, 03:27 am</strong>
			</dt>
			<dd class="postbody">
				i imagine that once you let gpg get greedy with the secmem the limiting factor will be your entropy pool<br /><br />/dev/random is better than /dev/urandom but it&#039;s slow and werner says that even /dev/random might not provide enough entropy estimation. oh well :( i guess you can make it faster by piping your ethernet card into rndcontrol and downloading a bunch of porn or by doing something hackish like &quot;rngd –r /dev/urandom;find /usr /var /tmp /opt -type f -print0 | xargs -0 cat &gt; /dev/null&quot;
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 18, 2012, 03:40 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg471133#msg471133">Quote from: Shannon on September 18, 2012, 03:27 am</a></div></div><blockquote class="bbc_standard_quote">i imagine that once you let gpg get greedy with the secmem the limiting factor will be your entropy pool<br /><br />/dev/random is better than /dev/urandom but it&#039;s slow and werner says that even /dev/random might not provide enough entropy estimation. oh well :( i guess you can make it faster by piping your ethernet card into rndcontrol and downloading a bunch of porn or by doing something hackish like &quot;rngd –r /dev/urandom;find /usr /var /tmp /opt -type f -print0 | xargs -0 cat &gt; /dev/null&quot;<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Once you have to start worrying about whether or not the entropy pool is solid enough during each key generation then you really have to question whether or not there is any practical value in generating asymmetric keys larger than 4K or even 8K.<br /><br />The reality is that if a 4K key isn&#039;t enough for whatever you&#039;re doing then you&#039;re in much deeper shit than this place is ever likely to attract and the vectors of attack used against you will be very different than simply attempting to crack your messages.<br /><br />Still, people wanted to know how to do this and it didn&#039;t take long to write.&nbsp; ;)<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 18, 2012, 09:28 am</strong>
			</dt>
			<dd class="postbody">
				At the end of the day fucking with the source code of GPG or trying hackish ways of seeding /dev/urandom are far more likely to fuck you than you are to be fucked by using a 4,096 bit RSA key. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 18, 2012, 09:30 am</strong>
			</dt>
			<dd class="postbody">
				/dev/urandom should be more than good enough, I believe that /dev/random attempts to accumulate true randomness and /dev/urandom is pseudo-randomness that is seeded from /dev/random, if an attacker doesn&#039;t know the seed provided from /dev/random they should not be able to determine the output of /dev/urandom 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 18, 2012, 09:37 am</strong>
			</dt>
			<dd class="postbody">
				Just looked it up, /dev/random produces output only if there is sufficient entropy in the entropy pool, /dev/urandom doesn&#039;t block (unblock random) if there is not sufficient entropy and keeps producing output. It is unlikely that a freshly seeded /dev/urandom will be pwnable but it is theoretically weak to certain attacks if there is not sufficient entropy, /dev/random on the other hand is not weak to these theoretical attacks because it blocks until there is sufficient entropy. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 18, 2012, 10:18 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg471659#msg471659">Quote from: kmfkewm on September 18, 2012, 09:28 am</a></div></div><blockquote class="bbc_standard_quote">At the end of the day fucking with the source code of GPG or trying hackish ways of seeding /dev/urandom are far more likely to fuck you than you are to be fucked by using a 4,096 bit RSA key.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />No arguments here.&nbsp; Seriously, 4096-bit RSA or Elgamal is plenty good enough for almost everyone up to something dodgy and certainly everyone here.&nbsp; By the time we actually need to worry about something stronger than 4K keys we&#039;ll all be using ECC keys anyway.<br /><br />Still, Pine said she wanted to generate an 8K key because it looks cool, so here&#039;s the guide.<br />
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>Shannon</strong> on <strong>September 18, 2012, 06:03 pm</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg471663#msg471663">Quote from: kmfkewm on September 18, 2012, 09:30 am</a></div></div><blockquote class="bbc_standard_quote">/dev/urandom should be more than good enough<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />dd9jn, the lead developer of gpg disagrees with this, his opinion is that urandom is certainly not good enough and random is probably not good enough, i don&#039;t know why he thinks this though and will have to ask him next time i see him online<br /><br />i agree with the both of you though that you don&#039;t need to worry about the quality of your entropy pool unless your name is saddam bin laden muhammad ali jihad, i was mainly worried about the speed of the pool since i&#039;m an impatient fuck
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>kmfkewm</strong> on <strong>September 20, 2012, 07:46 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg472436#msg472436">Quote from: Shannon on September 18, 2012, 06:03 pm</a></div></div><blockquote class="bbc_standard_quote"><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg471663#msg471663">Quote from: kmfkewm on September 18, 2012, 09:30 am</a></div></div><blockquote class="bbc_alternate_quote">/dev/urandom should be more than good enough<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />dd9jn, the lead developer of gpg disagrees with this, his opinion is that urandom is certainly not good enough and random is probably not good enough, i don&#039;t know why he thinks this though and will have to ask him next time i see him online<br /><br />i agree with the both of you though that you don&#039;t need to worry about the quality of your entropy pool unless your name is saddam bin laden muhammad ali jihad, i was mainly worried about the speed of the pool since i&#039;m an impatient fuck<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Well if /dev/random isn&#039;t good enough then /dev/urandom can&#039;t possibly be. 
			</dd>
			<dt class="postheader">
				Title: <strong>Re: GPG HOWTO: Compiling GPG 1.4.x to Support Larger Key Creation (advanced)</strong><br />
				Post by: <strong>LouisCyphre</strong> on <strong>September 20, 2012, 11:03 am</strong>
			</dt>
			<dd class="postbody">
				<div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg476181#msg476181">Quote from: kmfkewm on September 20, 2012, 07:46 am</a></div></div><blockquote class="bbc_standard_quote"><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg472436#msg472436">Quote from: Shannon on September 18, 2012, 06:03 pm</a></div></div><blockquote class="bbc_alternate_quote"><div class="quoteheader"><div class="topslice_quote"><a href="http://dkn255hz262ypmii.onion/index.php?topic=42923.msg471663#msg471663">Quote from: kmfkewm on September 18, 2012, 09:30 am</a></div></div><blockquote class="bbc_standard_quote">/dev/urandom should be more than good enough<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />dd9jn, the lead developer of gpg disagrees with this, his opinion is that urandom is certainly not good enough and random is probably not good enough, i don&#039;t know why he thinks this though and will have to ask him next time i see him online<br /><br />i agree with the both of you though that you don&#039;t need to worry about the quality of your entropy pool unless your name is saddam bin laden muhammad ali jihad, i was mainly worried about the speed of the pool since i&#039;m an impatient fuck<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Well if /dev/random isn&#039;t good enough then /dev/urandom can&#039;t possibly be.<br /></blockquote><div class="quotefooter"><div class="botslice_quote"></div></div><br />Don&#039;t forget that the behaviour of /dev/random and /dev/urandon (as well as other [P]RNGs like /dev/arandom and EGD) vary according to operating system.&nbsp; So far you&#039;ve both been discussing the Linux specific variation between /dev/random and /dev/urandom.<br /><br />https://en.wikipedia.org/wiki//dev/random<br />
			</dd>
		</dl>
		<div id="footer" class="smalltext">
			
			<span class="smalltext" style="display: inline; visibility: visible; font-family: Verdana, Arial, sans-serif;"><a href="http://dkn255hz262ypmii.onion/index.php?action=credits" title="Simple Machines Forum" target="_blank" class="new_win">SMF 2.0.5</a> |
 <a href="http://www.simplemachines.org/about/smf/license.php" title="License" target="_blank" class="new_win">SMF &copy; 2013</a>, <a href="http://www.simplemachines.org" title="Simple Machines" target="_blank" class="new_win">Simple Machines</a>
			</span>
		</div>
	</body>
</html>